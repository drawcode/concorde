var Class=function(b){var a=function(){this.initialize.apply(this,arguments)};for(var c in b){a.prototype[c]=b[c]}if(!a.prototype.initialize){a.prototype.initialize=function(){}}return a};if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/*!
 * A crc32 function that will produce the same result as PHP's crc32() function
 * (http://php.net/crc32).
 *
 * The string used in PHP must be encoded in UTF-8 or the checksums will be
 * different. Use the following PHP to get the unsigned integer result:
 *
 *     sprintf('%u', crc32($string));
 *
 * Copyright 2010, Will Bond <will@wbond.net>
 * Released under the MIT license
 */
(function(){var a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];crc32=function(c){c=unescape(encodeURI(c));var e=0^(-1);var b=c.length;for(var d=0;d<b;d++){e=(e>>>8)^a[(e^c.charCodeAt(d))&255]}e=e^(-1);if(e<0){e+=4294967296}return e}})();var qs=(function(d){if(d==""){return{}}var c={};for(var e=0;e<d.length;++e){var f=d[e].split("=");if(f.length!=2){continue}c[f[0]]=decodeURIComponent(f[1].replace(/\+/g," "))}return c})(window.location.search.substr(1).split("&"));new function(e){var d=e.separator||"&";var c=e.spaces===false?false:true;var a=e.suffix===false?"":"[]";var g=e.prefix===false?false:true;var b=g?e.hash===true?"#":"?":"";var f=e.numbers===false?false:true;jQuery.query=new function(){var h=function(n,m){return n!=undefined&&n!==null&&(!!m?n.constructor==m:true)};var j=function(s){var n,r=/\[([^[]*)\]/g,o=/^(\S+?)(\[\S*\])?$/.exec(s),p=o[1],q=[];while(n=r.exec(o[2])){q.push(n[1])}return[p,q]};var l=function(t,s,r){var u,q=s.shift();if(typeof t!="object"){t=null}if(q===""){if(!t){t=[]}if(h(t,Array)){t.push(s.length==0?r:l(null,s.slice(0),r))}else{if(h(t,Object)){var p=0;while(t[p++]!=null){}t[--p]=s.length==0?r:l(t[p],s.slice(0),r)}else{t=[];t.push(s.length==0?r:l(null,s.slice(0),r))}}}else{if(q&&q.match(/^\s*[0-9]+\s*$/)){var n=parseInt(q,10);if(!t){t=[]}t[n]=s.length==0?r:l(t[n],s.slice(0),r)}else{if(q){var n=q.replace(/^\s*|\s*$/g,"");if(!t){t={}}if(h(t,Array)){var m={};for(var p=0;p<t.length;++p){m[p]=t[p]}t=m}t[n]=s.length==0?r:l(t[n],s.slice(0),r)}else{return r}}}return t};var k=function(m){var n=this;n.keys={};if(m.queryObject){jQuery.each(m.get(),function(o,p){n.SET(o,p)})}else{jQuery.each(arguments,function(){var o=""+this;o=decodeURIComponent(o);o=o.replace(/^[?#]/,"");o=o.replace(/[;&]$/,"");if(c){o=o.replace(/[+]/g," ")}jQuery.each(o.split(/[&;]/),function(){var p=this.split("=")[0];var q=this.split("=")[1];if(!p){return}if(f){if(/^[+-]?[0-9]+\.[0-9]*$/.test(q)){q=parseFloat(q)}else{if(/^[+-]?[0-9]+$/.test(q)){q=parseInt(q,10)}}}q=(!q&&q!==0)?true:q;if(q!==false&&q!==true&&typeof q!="number"){q=q}n.SET(p,q)})})}return n};k.prototype={queryObject:true,has:function(m,n){var o=this.get(m);return h(o,n)},GET:function(n){if(!h(n)){return this.keys}var m=j(n),o=m[0],q=m[1];var p=this.keys[o];while(p!=null&&q.length!=0){p=p[q.shift()]}return typeof p=="number"?p:p||""},get:function(m){var n=this.GET(m);if(h(n,Object)){return jQuery.extend(true,{},n)}else{if(h(n,Array)){return n.slice(0)}}return n},SET:function(n,s){var p=!h(s)?null:s;var m=j(n),o=m[0],r=m[1];var q=this.keys[o];this.keys[o]=l(q,r.slice(0),p);return this},set:function(m,n){return this.copy().SET(m,n)},REMOVE:function(m){return this.SET(m,null).COMPACT()},remove:function(m){return this.copy().REMOVE(m)},EMPTY:function(){var m=this;jQuery.each(m.keys,function(n,o){delete m.keys[n]});return m},load:function(m){var o=m.replace(/^.*?[#](.+?)(?:\?.+)?$/,"$1");var n=m.replace(/^.*?[?](.+?)(?:#.+)?$/,"$1");return new k(m.length==n.length?"":n,m.length==o.length?"":o)},empty:function(){return this.copy().EMPTY()},copy:function(){return new k(this)},COMPACT:function(){function m(p){var o=typeof p=="object"?h(p,Array)?[]:{}:p;if(typeof p=="object"){function n(s,q,r){if(h(s,Array)){s.push(r)}else{s[q]=r}}jQuery.each(p,function(q,r){if(!h(r)){return true}n(o,q,m(r))})}return o}this.keys=m(this.keys);return this},compact:function(){return this.copy().COMPACT()},toString:function(){var o=0,r=[],q=[],n=this;var m=function(s,t,u){if(!h(u)||u===false){return}var v=[encodeURIComponent(t)];if(u!==true){v.push("=");v.push(encodeURIComponent(u))}s.push(v.join(""))};var p=function(t,s){var u=function(v){return !s||s==""?[v].join(""):[s,"[",v,"]"].join("")};jQuery.each(t,function(v,w){if(typeof w=="object"){p(w,u(v))}else{m(q,u(v),w)}})};p(this.keys);if(q.length>0){r.push(b)}r.push(q.join(d));return r.join("")}};return new k(location.search,location.hash)}}(jQuery.query||{});var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){return this._utf8_decode(unescape(a))},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};var hexcase=0;var b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function any_hmac_sha1(a,c,b){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(c)),b)}function sha1_vm_test(){return hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),a.length*8))}function rstr_hmac_sha1(c,f){var e=rstr2binb(c);if(e.length>16){e=binb_sha1(e,c.length*8)}var a=Array(16),d=Array(16);for(var b=0;b<16;b++){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=binb_sha1(a.concat(rstr2binb(f)),512+f.length*8);return binb2rstr(binb_sha1(d.concat(g),512+160))}function rstr2hex(c){try{hexcase}catch(g){hexcase=0}var f=hexcase?"0123456789ABCDEF":"0123456789abcdef";var b="";var a;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);b+=f.charAt((a>>>4)&15)+f.charAt(a&15)}return b}function rstr2b64(c){try{b64pad}catch(h){b64pad=""}var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b="";var a=c.length;for(var f=0;f<a;f+=3){var k=(c.charCodeAt(f)<<16)|(f+1<a?c.charCodeAt(f+1)<<8:0)|(f+2<a?c.charCodeAt(f+2):0);for(var d=0;d<4;d++){if(f*8+d*6>c.length*8){b+=b64pad}else{b+=g.charAt((k>>>6*(3-d))&63)}}}return b}function rstr2any(k,c){var b=c.length;var j=Array();var h,a,l,e;var g=Array(Math.ceil(k.length/2));for(h=0;h<g.length;h++){g[h]=(k.charCodeAt(h*2)<<8)|k.charCodeAt(h*2+1)}while(g.length>0){e=Array();l=0;for(h=0;h<g.length;h++){l=(l<<16)+g[h];a=Math.floor(l/b);l-=a*b;if(e.length>0||a>0){e[e.length]=a}}j[j.length]=l;g=e}var d="";for(h=j.length-1;h>=0;h--){d+=c.charAt(j[h])}var f=Math.ceil(k.length*8/(Math.log(c.length)/Math.log(2)));for(h=d.length;h<f;h++){d=c[0]+d}return d}function str2rstr_utf8(c){var b="";var d=-1;var a,e;while(++d<c.length){a=c.charCodeAt(d);e=d+1<c.length?c.charCodeAt(d+1):0;if(55296<=a&&a<=56319&&56320<=e&&e<=57343){a=65536+((a&1023)<<10)+(e&1023);d++}if(a<=127){b+=String.fromCharCode(a)}else{if(a<=2047){b+=String.fromCharCode(192|((a>>>6)&31),128|(a&63))}else{if(a<=65535){b+=String.fromCharCode(224|((a>>>12)&15),128|((a>>>6)&63),128|(a&63))}else{if(a<=2097151){b+=String.fromCharCode(240|((a>>>18)&7),128|((a>>>12)&63),128|((a>>>6)&63),128|(a&63))}}}}}return b}function str2rstr_utf16le(b){var a="";for(var c=0;c<b.length;c++){a+=String.fromCharCode(b.charCodeAt(c)&255,(b.charCodeAt(c)>>>8)&255)}return a}function str2rstr_utf16be(b){var a="";for(var c=0;c<b.length;c++){a+=String.fromCharCode((b.charCodeAt(c)>>>8)&255,b.charCodeAt(c)&255)}return a}function rstr2binb(b){var a=Array(b.length>>2);for(var c=0;c<a.length;c++){a[c]=0}for(var c=0;c<b.length*8;c+=8){a[c>>5]|=(b.charCodeAt(c/8)&255)<<(24-c%32)}return a}function binb2rstr(b){var a="";for(var c=0;c<b.length*32;c+=8){a+=String.fromCharCode((b[c>>5]>>>(24-c%32))&255)}return a}function binb_sha1(v,o){v[o>>5]|=128<<(24-o%32);v[((o+64>>9)<<4)+15]=o;var y=Array(80);var u=1732584193;var s=-271733879;var r=-1732584194;var q=271733878;var p=-1009589776;for(var l=0;l<v.length;l+=16){var n=u;var m=s;var k=r;var h=q;var f=p;for(var g=0;g<80;g++){if(g<16){y[g]=v[l+g]}else{y[g]=bit_rol(y[g-3]^y[g-8]^y[g-14]^y[g-16],1)}var z=safe_add(safe_add(bit_rol(u,5),sha1_ft(g,s,r,q)),safe_add(safe_add(p,y[g]),sha1_kt(g)));p=q;q=r;r=bit_rol(s,30);s=u;u=z}u=safe_add(u,n);s=safe_add(s,m);r=safe_add(r,k);q=safe_add(q,h);p=safe_add(p,f)}return Array(u,s,r,q,p)}function sha1_ft(e,a,g,f){if(e<20){return(a&g)|((~a)&f)}if(e<40){return a^g^f}if(e<60){return(a&g)|(a&f)|(g&f)}return a^g^f}function sha1_kt(a){return(a<20)?1518500249:(a<40)?1859775393:(a<60)?-1894007588:-899497514}function safe_add(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)}function bit_rol(a,b){return(a<<b)|(a>>>(32-b))}
/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/
(function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(b,e){var g=a,d=[];e=e||g.length;if(b){for(var c=0;c<b;c++){d[c]=g[0|Math.random()*e]}}else{var f;d[8]=d[13]=d[18]=d[23]="-";d[14]="4";for(var c=0;c<36;c++){if(!d[c]){f=0|Math.random()*16;d[c]=g[(c==19)?(f&3)|8:f]}}}return d.join("")};Math.uuidFast=function(){var f=a,d=new Array(36),c=0,e;for(var b=0;b<36;b++){if(b==8||b==13||b==18||b==23){d[b]="-"}else{if(c<=2){c=33554432+(Math.random()*16777216)|0}e=c&15;c=c>>4;d[b]=f[(b==19)?(e&3)|8:e]}}return d.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=Math.random()*16|0,b=e=="x"?d:(d&3|8);return b.toString(16)}).toUpperCase()}})();
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(a,b){if(typeof exports==="object"&&exports){module.exports=b}else{if(typeof define==="function"&&define.amd){define(b)}else{a.Mustache=b}}}(this,(function(){var w={};w.name="mustache.js";w.version="0.7.2";w.tags=["{{","}}"];w.Scanner=u;w.Context=s;w.Writer=q;var d=/\s*/;var l=/\s+/;var h=/\S/;var g=/\s*=/;var n=/\s*\}/;var t=/#|\^|\/|>|\{|&|=|!/;var j=RegExp.prototype.test;var v=Object.prototype.toString;function o(z,y){return j.call(z,y)}function f(y){return !o(h,y)}var k=Array.isArray||function(y){return v.call(y)==="[object Array]"};function e(y){return y.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function m(y){return String(y).replace(/[&<>"'\/]/g,function(z){return c[z]})}w.escape=m;function u(y){this.string=y;this.tail=y;this.pos=0}u.prototype.eos=function(){return this.tail===""};u.prototype.scan=function(z){var y=this.tail.match(z);if(y&&y.index===0){this.tail=this.tail.substring(y[0].length);this.pos+=y[0].length;return y[0]}return""};u.prototype.scanUntil=function(z){var y,A=this.tail.search(z);switch(A){case -1:y=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:y="";break;default:y=this.tail.substring(0,A);this.tail=this.tail.substring(A);this.pos+=A}return y};function s(y,z){this.view=y;this.parent=z;this._cache={}}s.make=function(y){return(y instanceof s)?y:new s(y)};s.prototype.push=function(y){return new s(y,this)};s.prototype.lookup=function(y){var B=this._cache[y];if(!B){if(y=="."){B=this.view}else{var A=this;while(A){if(y.indexOf(".")>0){B=A.view;var C=y.split("."),z=0;while(B&&z<C.length){B=B[C[z++]]}}else{B=A.view[y]}if(B!=null){break}A=A.parent}}this._cache[y]=B}if(typeof B==="function"){B=B.call(this.view)}return B};function q(){this.clearCache()}q.prototype.clearCache=function(){this._cache={};this._partialCache={}};q.prototype.compile=function(A,y){var z=this._cache[A];if(!z){var B=w.parse(A,y);z=this._cache[A]=this.compileTokens(B,A)}return z};q.prototype.compilePartial=function(z,B,y){var A=this.compile(B,y);this._partialCache[z]=A;return A};q.prototype.getPartial=function(y){if(!(y in this._partialCache)&&this._loadPartial){this.compilePartial(y,this._loadPartial(y))}return this._partialCache[y]};q.prototype.compileTokens=function(A,z){var y=this;return function(B,D){if(D){if(typeof D==="function"){y._loadPartial=D}else{for(var C in D){y.compilePartial(C,D[C])}}}return p(A,y,s.make(B),z)}};q.prototype.render=function(A,y,z){return this.compile(A)(y,z)};function p(F,z,y,I){var C="";var A,G,H;for(var D=0,E=F.length;D<E;++D){A=F[D];G=A[1];switch(A[0]){case"#":H=y.lookup(G);if(typeof H==="object"){if(k(H)){for(var B=0,K=H.length;B<K;++B){C+=p(A[4],z,y.push(H[B]),I)}}else{if(H){C+=p(A[4],z,y.push(H),I)}}}else{if(typeof H==="function"){var J=I==null?null:I.slice(A[3],A[5]);H=H.call(y.view,J,function(L){return z.render(L,y)});if(H!=null){C+=H}}else{if(H){C+=p(A[4],z,y,I)}}}break;case"^":H=y.lookup(G);if(!H||(k(H)&&H.length===0)){C+=p(A[4],z,y,I)}break;case">":H=z.getPartial(G);if(typeof H==="function"){C+=H(y)}break;case"&":H=y.lookup(G);if(H!=null){C+=H}break;case"name":H=y.lookup(G);if(H!=null){C+=w.escape(H)}break;case"text":C+=G;break}}return C}function x(E){var z=[];var D=z;var F=[];var B;for(var A=0,y=E.length;A<y;++A){B=E[A];switch(B[0]){case"#":case"^":F.push(B);D.push(B);D=B[4]=[];break;case"/":var C=F.pop();C[5]=B[2];D=F.length>0?F[F.length-1][4]:z;break;default:D.push(B)}}return z}function a(D){var A=[];var C,z;for(var B=0,y=D.length;B<y;++B){C=D[B];if(C){if(C[0]==="text"&&z&&z[0]==="text"){z[1]+=C[1];z[3]=C[3]}else{z=C;A.push(C)}}}return A}function r(y){return[new RegExp(e(y[0])+"\\s*"),new RegExp("\\s*"+e(y[1]))]}w.parse=function(O,E){O=O||"";E=E||w.tags;if(typeof E==="string"){E=E.split(l)}if(E.length!==2){throw new Error("Invalid tags: "+E.join(", "))}var I=r(E);var A=new u(O);var G=[];var F=[];var D=[];var P=false;var N=false;function M(){if(P&&!N){while(D.length){delete F[D.pop()]}}else{D=[]}P=false;N=false}var B,z,H,J,C;while(!A.eos()){B=A.pos;H=A.scanUntil(I[0]);if(H){for(var K=0,L=H.length;K<L;++K){J=H.charAt(K);if(f(J)){D.push(F.length)}else{N=true}F.push(["text",J,B,B+1]);B+=1;if(J=="\n"){M()}}}if(!A.scan(I[0])){break}P=true;z=A.scan(t)||"name";A.scan(d);if(z==="="){H=A.scanUntil(g);A.scan(g);A.scanUntil(I[1])}else{if(z==="{"){H=A.scanUntil(new RegExp("\\s*"+e("}"+E[1])));A.scan(n);A.scanUntil(I[1]);z="&"}else{H=A.scanUntil(I[1])}}if(!A.scan(I[1])){throw new Error("Unclosed tag at "+A.pos)}C=[z,H,B,A.pos];F.push(C);if(z==="#"||z==="^"){G.push(C)}else{if(z==="/"){if(G.length===0){throw new Error('Unopened section "'+H+'" at '+B)}var y=G.pop();if(y[1]!==H){throw new Error('Unclosed section "'+y[1]+'" at '+B)}}else{if(z==="name"||z==="{"||z==="&"){N=true}else{if(z==="="){E=H.split(l);if(E.length!==2){throw new Error("Invalid tags at "+B+": "+E.join(", "))}I=r(E)}}}}}var y=G.pop();if(y){throw new Error('Unclosed section "'+y[1]+'" at '+A.pos)}F=a(F);return x(F)};var b=new q();w.clearCache=function(){return b.clearCache()};w.compile=function(z,y){return b.compile(z,y)};w.compilePartial=function(z,A,y){return b.compilePartial(z,A,y)};w.compileTokens=function(z,y){return b.compileTokens(z,y)};w.render=function(A,y,z){return b.render(A,y,z)};w.to_html=function(B,z,A,C){var y=w.render(B,z,A);if(typeof C==="function"){C(y)}else{return y}};return w}())));jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m=$.extend({},m);m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};var serviceApi=null;var ServiceAPI=Class({Instance:function(){return this},services:null,controllers:null,profile:null,tracker:null,Profile:Class({geo:null,uuid:null,localAttributeCodes:{serviceApiAtts:"serviceApiAtts",geoLat:"geoLat",geoLong:"geoLong",colorBackgroundHighlight:"colorBackgroundHighlight",colorHighlight:"colorHighlight"},localAttributes:null,getLocation:function(){},initAttributes:function(){if(this.localAttributes==null){this.localAttributes=JSON.parse($.cookie(this.localAttributeCodes.serviceApiAtts))}if(this.localAttributes==null){this.localAttributes={}}},hasAttribute:function(a){this.initAttributes();if(this.localAttributes!=null){if(this.localAttributes[a]!=null){if(!ServiceAPI.Instance.util.isNullOrEmptyString(a)){return true}}}return false},getAttribute:function(a){var b=null;this.initAttributes();if(this.hasAttribute(a)){b=this.localAttributes[a]}return b},setAttribute:function(a,b){this.initAttributes();this.localAttributes[a]=b;$.cookie(this.localAttributeCodes.serviceApiAtts,JSON.stringify(this.localAttributes),{expires:7,path:"/"})},setCustomColorHighlight:function(a){this.setAttribute(this.localAttributeCodes.colorHighlight,a)},getCustomColorHighlight:function(){return this.getAttribute(this.localAttributeCodes.colorHighlight)},setCustomColorBackgroundHighlight:function(a){this.setAttribute(this.localAttributeCodes.colorBackgroundHighlight,a)},getCustomColorBackgroundHighlight:function(){return this.getAttribute(this.localAttributeCodes.colorBackgroundHighlight)},setGeoLat:function(a){this.setAttribute(this.localAttributeCodes.geoLat,a)},getGeoLat:function(){return this.getAttribute(this.localAttributeCodes.geoLat)},setGeoLong:function(a){this.setAttribute(this.localAttributeCodes.geoLong,a)},getGeoLong:function(){return this.getAttribute(this.localAttributeCodes.geoLong)},loginFacebook:function(){}}),Tracker:Class({setAccount:function(a){try{if(ga){ga("create",a)}}catch(b){}try{if(!ServiceAPI.Instance.util.isNullOrEmpty(_gaq)){_gaq.push(["_setAccount",a])}}catch(b){}},trackPageView:function(a){try{if(ga){ga("send","pageview")}}catch(b){}try{if(!ServiceAPI.Instance.util.isNullOrEmpty(_gaq)){_gaq.push(["_trackPageview",a])}}catch(b){}},trackEvent:function(b,c,f,a){try{if(ga){if(ServiceAPI.Instance.util.isNullOrEmptyString(f)){f="default"}if(ServiceAPI.Instance.util.isNullOrEmptyString(a)){a=1}ga("send","event",b,c,f,a);ServiceAPI.Instance.util.log("trackEvent:ga:"," category:"+b+" action:"+c+" opt_label:"+f+" opt_value:"+a)}}catch(d){}try{if(!ServiceAPI.Instance.util.isNullOrEmpty(_gaq)){_gaq.push(["_trackEvent",b,c,f,a]);ServiceAPI.Instance.util.log("trackEvent:gaq:"," category:"+b+" action:"+c+" opt_label:"+f+" opt_value:"+a)}}catch(d){}},trackEventCRM:function(b,a,c){ServiceAPI.Instance.tracker.trackEvent("crm-number-campaign:"+b,b+":"+a,a,1)}}),Utility:Class({log:function(a,b){if(window.console){console.log(a,b)}},renderWrapTagStyles:function(a,c,b){return"<"+a+' class="'+b+'">'+c+"</"+a+">"},renderWrapTagStylesId:function(a,c,b,d){return"<"+a+' id="'+d+'" class="'+b+'">'+c+"</"+a+">"},renderWrapTag:function(a,b){return"<"+a+">"+b+"</"+a+">"},formatDatePrettyString:function(a){return moment(a,"YYYY-MM-DDTHH:mm:ss.SSS Z").fromNow()},isNullOrEmptyString:function(a){if(a==null||a==""||a=="undefined"){return true}return false},isNullOrEmpty:function(a){if((a==null||a==""||a=="undefined")&&a!=false){return true}return false},stripToAlphanumerics:function(a){a=a.replace(/[^\w\s]|/g,"");return a},toLower:function(a){return a.toLowerCase()},filterToUrlFormat:function(a){a=this.strip_to_alphanumerics(a);a=this.to_lower(a);a=a.replace("_","-");a=a.replace(" ","-");return a},getObjectValue:function(b,a){if(!this.isNullOrEmpty(b)){if(!isNullOrEmpty(b[a])){return b[a]}}return""},fillObjectValue:function(a,c,b,d){if(!this.isNullOrEmpty(c[b])){if(b!="div"){a+=d+c[b]}}return a},getUrlParamValue:function(a,c){var d="";if(a.indexOf(c+"/")>-1){var e=a.split("/");for(var b=0;b<e.length;b++){if(e[b]==c){if(e[b+1]!=null){d=e[b+1]}}}}return d},changeUrlToState:function(b,f,d){var c="";if(b.indexOf(f)>-1){var a=b.split(this.param_value_separator);for(var e=0;e<a.length;e++){if(a[e]==f){a[e+1]=d}}c=a.join(this.param_value_separator)}else{if(b.indexOf(f+this.param_value_separator)==-1){if(b.lastIndexOf(this.param_value_separator)==b.length-1){b=b.substr(0,b.length-1)}c=b+this.param_value_separator+f+this.param_value_separator+d}}return c},endsWithSlash:function(a){return a.match(/\/$/)},isAbsoluteUrl:function(a){var b=/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi;return this.regexMatch(a,b)},regexMatch:function(a,d){var c=new RegExp(d);var b=a;if(b.match(c)){return true}else{return false}},baseEncode:function(b,a){return(b).toString(a)},baseDecode:function(b,a){return parseInt(b,a)},base36Encode:function(a){return this.baseEncode(a,36)},base36Decode:function(a){return this.baseEncode(a,36)},base64Encode:function(a){return this.baseEncode(a,64)},shortCode:function(a){return this.base36Encode(crc32(b64_sha1(a)+"="))},loadContent:function(b,a){if($(b)!=null){$(b).load(a,function(){ServiceAPI.Instance.log("Content Loaded: "+b+" url:"+a)})}}}),Controllers:Class({uiController:null,apiController:null,UIController:Class({screenHeight:null,screenWidth:null,fpsLabel:null,offscreenLeft:-3500,offscreenRight:-3500,offscreenTop:-3500,offscreenBottom:50000,profileBackground:"light",profilColor:"red",currentPanel:"",currentEffect:"wave-top-left",currentViewData:{section:"map",elevation:"country",tileData:[],title:"Select a Region",description:"Select a Region",code:"us",displayCode:"US"},customBrandedBackgroundItems:["#tile-settings","#tile-overlay-info",".panel-results-tile","#panel-info-header","#tile-search","#tile-brand","#tile-logo"],customBrandedItems:["#title-section"],customColorBackgroundClasses:["color-background-brand-red","color-background-brand-pink","color-background-brand-lightblue","color-background-brand-darkblue","color-background-brand-teal"],customColorClasses:["color-brand-red","color-brand-pink","color-brand-lightblue","color-brand-darkblue","color-brand-teal"],initialize:function(){},setContext:function(b,a){$("#title-section").text(b);$("#tile-indicator").text(a)},togglePanel:function(a){if($(a).hasClass("closed-right")){hidePanel(a)}else{showPanel(a)}},showPanel:function(a){if($(a).hasClass("closed-right")){$(a).removeClass("closed-right")}},hidePanel:function(a){if(!$(a).hasClass("closed-right")){$(a).addClass("closed-right")}},presentPanel:function(a){this.hidePanel("#panel-login");this.hidePanel("#panel-login");if(a!="settings"){this.hidePanel("#panel-settings")}if(a!="login"){this.hidePanel("#panel-login")}if(a!="info"){this.hidePanel("#panel-info")}if(a!="results"){this.hidePanel("#panel-results")}if(a!="filters"){this.hidePanel("#panel-filters")}if(this.currentPanel==a){this.hidePanel("#panel-"+a);this.currentPanel="";return}ServiceAPI.Instance.log("presentPanel","#panel-"+a);this.showPanel("#panel-"+a);this.currentPanel=a},toggleSettings:function(){this.togglePanel("#panel-settings")},toggleResults:function(){this.togglePanel("#panel-results")},toggleInfo:function(){this.togglePanel("#panel-info")},toggleFilters:function(){this.togglePanel("#panel-filters")},showSettings:function(){this.showPanel("#panel-settings")},showResults:function(){this.showPanel("#panel-results")},showInfo:function(){this.showPanel("#panel-info")},showFilters:function(){this.showPanel("#panel-filters")},hideSettings:function(){this.hidePanel("#panel-settings")},hideResults:function(){this.hidePanel("#panel-results")},hideInfo:function(){this.hidePanel("#panel-info")},hideFilters:function(){this.hidePanel("#panel-filters")},adjustCurrentLayoutToScreen:function(){this.screenHeight=$(window).height();this.screenWidth=$(window).width()},applyClass:function(b,a){if(!$(b).hasClass(a)){$(b).addClass(a)}},removeClass:function(b,a){if($(b).hasClass(a)){$(b).removeClass(a)}},changeCSS:function(d,b,c){var e=null;if(document.getElementById){e="cssRules"}if(e){for(var a=0;a<document.styleSheets[0][e].length;a++){if(document.styleSheets[0][e][a].selectorText==d){document.styleSheets[0][e][a].style[b]=c}}}},toggleLoginContainer:function(){if($("#login-container .card").hasClass("flip")){$("#login-container .card").removeClass("flip")}else{$("#login-container .card").addClass("flip")}},initColors:function(){ServiceAPI.Instance.log("initColors","");this.applyClass("html","color-background-light");this.applyClass("body","color-background-light");this.applyClass("#tile-settings","color-light");this.applyClass("#tile-search","color-light");this.applyClass("#tile-brand","color-highlight");this.applyClass("#tile-indicator","color-background-black");this.applyClass("#tile-indicator","color-light");this.applyClass(".panel-background","color-background-dark");this.applyClass(".panel-background","opacity90");this.applyClass(".panel-background-overlay","color-background-light");this.applyClass(".panel-background-overlay","opacity90");this.profileColor=ServiceAPI.Instance.profile.getCustomColorHighlight();this.profileBackground=ServiceAPI.Instance.profile.getCustomColorBackgroundHighlight();if(this.profileColor==null){this.profileColor="red"}if(this.profileBackground==null){this.profileBackground="light"}this.changeBackground(this.profileBackground);this.changeHighlight(this.profileColor)},initDev:function(){},initCustomElements:function(){},changeSection:function(a,g,e,d,f,c,b,h){this.currentViewData.url=a;this.currentViewData.title=g;this.currentViewData.description=e;this.currentViewData.code=d;this.currentViewData.section=f;this.currentViewData.elevation=c;this.currentViewData.tileData=h;this.currentViewData.displayCode=b;this.pushHistoryState(this.currentViewData,g,a);this.loadHistoryState(this.currentViewData)},loadHistoryState:function(a){if(a!=null){this.setContext(a.title,a.displayCode.toUpperCase());ServiceAPI.Instance.controllers.templateController.currentMapLevel=a.elevation;ServiceAPI.Instance.controllers.templateController.currentMapCode=a.code}else{ServiceAPI.Instance.log("viewData was null")}ServiceAPI.Instance.controllers.canvasController.drawMap()},pushHistoryState:function(b,c,a){if(Modernizr.history){history.pushState(b,c,a)}},initHistoryState:function(){window.onpopstate=function(a){ServiceAPI.Instance.log("pathname: "+location.pathname)}},initPlacement:function(){},changeBackground:function(a){ServiceAPI.Instance.log("changing highlight to:"+a);ServiceAPI.Instance.profile.setCustomColorBackgroundHighlight(a);this.profileBackground=a;if(a=="light"){this.removeClass("html","color-background-highlight");this.removeClass("body","color-background-highlight");this.removeClass("#tile-indicator","color-background-light");this.removeClass("#tile-indicator","color-dark");this.removeClass("#panel-results-header","color-background-light");this.removeClass("#panel-results-header","color-dark");this.applyClass("html","color-background-light");this.applyClass("body","color-background-light");this.applyClass("#tile-indicator","color-background-black");this.applyClass("#tile-indicator","color-light");this.applyClass("#panel-results-header","color-background-black");this.applyClass("#panel-results-header","color-light")}else{this.removeClass("html","color-background-light");this.removeClass("body","color-background-light");this.removeClass("#tile-indicator","color-background-black");this.removeClass("#tile-indicator","color-light");this.removeClass("#panel-results-header","color-background-black");this.removeClass("#panel-results-header","color-light");this.applyClass("html","color-background-dark");this.applyClass("body","color-background-dark");this.applyClass("#tile-indicator","color-background-light");this.applyClass("#tile-indicator","color-dark");this.applyClass("#panel-results-header","color-background-light");this.applyClass("#panel-results-header","color-dark")}},removeCurrentBackgroundHighlights:function(){for(var b=0;b<this.customBrandedBackgroundItems.length;b++){ServiceAPI.Instance.log("customBrandedBackgroundItems:",this.customBrandedBackgroundItems[b]);for(var a=0;a<this.customColorBackgroundClasses.length;a++){ServiceAPI.Instance.log("customColorBackgroundClasses:",this.customColorBackgroundClasses[a]);this.removeClass(this.customBrandedBackgroundItems[b],this.customColorBackgroundClasses[a])}}},removeCurrentColorHighlights:function(){for(var b=0;b<this.customBrandedItems.length;b++){ServiceAPI.Instance.log("customBrandedItems:",this.customBrandedItems[b]);for(var a=0;a<this.customColorClasses.length;a++){ServiceAPI.Instance.log("customColorClasses:",this.customColorClasses[a]);this.removeClass(this.customBrandedItems[b],this.customColorClasses[a])}}},applyBackgroundHighlights:function(c){for(var a=0;a<this.customBrandedBackgroundItems.length;a++){var b="color-background-brand-"+c;ServiceAPI.Instance.log("colorToClass:",b);ServiceAPI.Instance.log("customBrandedBackgroundItems[i]:",this.customBrandedBackgroundItems[a]);this.applyClass(this.customBrandedBackgroundItems[a],b)}},applyColorHighlights:function(c){for(var a=0;a<this.customBrandedItems.length;a++){var b="color-brand-"+c;ServiceAPI.Instance.log("colorToClass:",b);ServiceAPI.Instance.log("customBrandedItems[i]:",this.customBrandedItems[a]);this.applyClass(this.customBrandedItems[a],b)}},changeHighlight:function(a){if(a=="red"||a=="lightblue"||a=="darkblue"||a=="pink"||a=="teal"){ServiceAPI.Instance.log("changing highlight to:",a);this.removeCurrentColorHighlights();this.removeCurrentBackgroundHighlights();this.applyBackgroundHighlights(a);this.applyColorHighlights(a);ServiceAPI.Instance.profile.setCustomColorHighlight(a)}},loadContentAll:function(a){$.getJSON(a,{cid:a,format:"json"},function(b){$.each(b,function(c,d){$(c).html(d)});$("#loading").hide()})},loadContentStart:function(){ServiceAPI.Instance.util.loadContent("#tile-login","/account/loginstart")},changeSectionData:function(c,a){var b=ServiceAPI.Instance.controllers.templateController.getTemplateDataItem(c,a);this.changeSection(b.url,b.displayName,b.displayName,b.code,"map",c,b.displayCode,b)},initTempTemplateButtons:function(){$(".transition-effect").on("click",function(a){ServiceAPI.Instance.log("click",this.id);ServiceAPI.Instance.controllers.uiController.currentEffect=this.id.replace("transition-","");ServiceAPI.Instance.controllers.uiController.changeSectionData(ServiceAPI.Instance.controllers.templateController.currentMapLevel,ServiceAPI.Instance.controllers.templateController.currentMapCode);a.preventDefault()})},adjustCurrentLayout:function(){setTimeout(this.adjustCurrentLayoutDelayed,2000)},adjustCurrentLayoutDelayed:function(){this.adjustCurrentLayout();if(ServiceAPI.Instance.controllers.canvasController.stage){ServiceAPI.Instance.controllers.canvasController.stage.clear()}ServiceAPI.Instance.controllers.canvasController.resizeCanvas()},eventHandlerClick:function(a){},eventHandlerTapOne:function(a){},eventHandlerTapTwo:function(a){},eventHandlerTapThree:function(a){},eventHandlertapFour:function(a){},eventHandlerSwipeOne:function(a){},eventHandlerSwipeTwo:function(a){},eventHandlerSwipeThree:function(a){},eventHandlerSwipeFour:function(a){},eventHandlerSwipeUp:function(a){},eventHandlerSwipeRightUp:function(a){},eventHandlerSwipeRight:function(a){},eventHandlerSwipeDown:function(a){},eventHandlerSwipeLeftDown:function(a){},eventHandlerSwipeLeft:function(a){},eventHandlerSwipeLeftUp:function(a){},eventHandler:function(a){},eventHandlerPinchOpen:function(a){},eventHandlerPinchClose:function(a){},eventHandlerRotateCW:function(a){},eventHandlerRotateCCW:function(a){},eventHandlerSwipeMove:function(a){},eventHandlerPinch:function(a){},eventHandlerRotate:function(a){}})}),Services:Class({apiUrlRoot:"/api/api",profileService:null,platformService:null,crmService:null,initialize:function(){ServiceAPI.Instance.util.log("initialized services",true)},log:function(a,b){if(window.console){console.log(a,b)}},ProfileService:Class({initialize:function(){ServiceAPI.Instance.log("initialized profile",true)},render:function(a){this.getProfile(a)},renderResponse:function(a,d){var c="all";var g=1;var h=200;if(a.rangeType){c=a.rangeType}if(a.page){g=a.page}if(a.pageSize){h=a.pageSize}var e="";var f="";var k="";f+='<table id="item-container" class="table">';f+=" <tr>";f+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Value","head-item item-head-value");f+=" </tr>";for(i=0;i<d.data.length;i++){f+=" <tr>";f+=ServiceAPI.Instance.util.renderWrapTagStyles("td",d.data[i].value_formatted,"item item-value");f+=" </tr>"}f+="</table>";var j={profileType:{code:"user",type:"string"},formatted:function(){return this.profileType.type},view_data:d};var b=Mustache.render(f,j);$(a.div).html(b)},getProfile:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/profile/"+a.code;b+="?range="+a.rangeType;b+="&page="+a.page;b+="&page-size="+a.pageSize;if(a.username){b+="&username="+a.username}b+="&format=json&callback=?";this.filter=a;ServiceAPI.Instance.log("serviceUrl:",b);$.get(b,null,this.getProfileCallback,"json")},getProfileCallback:function(b){var c=ServiceAPI.Instance.services.profile;var a=ServiceAPI.Instance.util.log;a("data",b);a("data.msg",b.msg);a("data.code",b.code);a("data.data",b.data);a("data.info",b.info);a("data.action",b.action);if(b.code>0||b.code.length>1){ServiceAPI.Instance.log("ERRORS:getProfileCallback",true)}else{ServiceAPI.Instance.log("SUCCESS:getProfileCallback",false);c.renderResponse(c.filter,b.data)}}}),CRMService:Class({filter:null,initialize:function(){ServiceAPI.Instance.log("initialized crm",true)},showVal:function(a){if(!ServiceAPI.Instance.util.isNullOrEmpty(a)){return a}return""},showValBool:function(a){if(a==undefined||a==null){return false}if(a==true||a=="true"||a==1||a=="1"){return true}return false},getPlaceholderText:function(a){var b="Type something...";if(a.indexOf("number")>-1){b="Phone Number"}else{if(a.indexOf("referrer")>-1){b="Campaign code"}else{if(a.indexOf("display_name")>-1){b="Description"}}}return b},blurEventRow:function(a){this.setShortCode(a)},changeEventRow:function(a){ServiceAPI.Instance.util.log("changeEventRow:id",a);$("#save-"+a).show();ServiceAPI.Instance.services.crmService.setShortCode(a);ServiceAPI.Instance.services.crmService.submitCRMNumberCampaignForm(a)},setShortCode:function(c){var a=$("#referrer-"+c).val();if(ServiceAPI.Instance.util.isNullOrEmptyString(a)){a="0"}var b=ServiceAPI.Instance.util.shortCode(a);$("#code-"+c).html(b)},getChangeEvent:function(c,a){var b="ServiceAPI.Instance.services.crmService.changeEventRow('"+c+"')";if(a.indexOf("number")>-1){}else{if(a.indexOf("referrer")>-1){}else{if(a.indexOf("display_name")>-1){}}}return b},showValCheckbox:function(f,a,e){var b="";if(this.showValBool(e)){b="checked"}var c=this.getChangeEvent(f,a);var d=this.getPlaceholderText(a);return'<input placeholder="'+d+'" onchange="'+c+'" type="checkbox" id="'+a+'" name="'+a+'" '+b+">"},showValInput:function(f,a,d){var e=this.blurEventRow(f);var b=this.getChangeEvent(f,a);var c=this.getPlaceholderText(a);return'<input type="text" placeholder="'+c+'" onchange="'+b+'"  onblur="'+e+'" class="table-cell-input" id="'+a+'" name="'+a+'" value="'+d+'">'},showValText:function(f,a,d){var e=this.blurEventRow(f);var b=this.getChangeEvent(f,a);var c=this.getPlaceholderText(a);return'<textarea  placeholder="'+c+'" onchange="'+b+'"  onblur="'+e+'" class="table-cell-text" id="'+a+'" name="'+a+'" >'+d+"</textarea>"},render:function(a){this.getCrmCampaignNumberMeta(a)},renderRow:function(a,b,j,l,m,c){var k=a;var h="";h+=" <tr>";h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValInput(k,"referrer-"+k,j),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValText(k,"display_name-"+k,l),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValInput(k,"number-"+k,m),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValCheckbox(k,"active-"+k,c),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",'<code><span id="code-'+k+'">'+this.showVal(b)+"</span></code>","item item-value no-edit");var g=' <a style="display:none;" id="save-';g+=k;g+='" class="btn btn-success" href="javascript:void(0);" onclick="ServiceAPI.Instance.services.crmService.submitCRMNumberCampaignForm(\''+k+"');\">Save</a>";var d=' <a id="delete-';d+=k;d+='" class="btn btn-danger" href="javascript:void(0);" onclick="ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaignDialog(\''+k+"');\">Delete</a>";var f=' <a  class="btn btn-info" href="javascript:void(0);" onclick="ServiceAPI.Instance.services.crmService.testCRMNumberCampaign(\''+k+"');\">Test</a>";var e=f+d+g;h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",e,"item item-value no-edit span3");h+=" </tr>";return h},renderResponse:function(c,g){var f="all";var k=1;var l=200;if(c.rangeType){f=c.rangeType}if(c.page){k=c.page}if(c.pageSize){l=c.pageSize}var h="";var j="";var n="";j+='<table id="crm-number-campaign-meta" class="table table-hover">';j+=" <thead>";j+=" <tr>";j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Campaign (URL Code)","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Source","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Phone Number","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Active","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Short Code","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Actions","head-item item-head-value");j+=" </tr>";j+=" </thead>";j+=" <tbody>";for(i=0;i<g.data.length;i++){var b=g.data[i].id;var a=g.data[i].code;var m=g.data[i].referrer;var o=g.data[i].display_name;var p=g.data[i].number;var e=g.data[i].active;j+=this.renderRow(b,a,m,o,p,e)}j+=" </tbody>";j+="</table>";$(c.div).html(j);$(c.div+" table tr td").bind("click",function d(q){if(!$(q.currentTarget).hasClass("no-edit")){if(q.currentTarget.contentEditable!=null){}else{}}})},adminAddNew:function(){var b=Math.uuid().toLowerCase();var a="#crm-number-campaign-meta tbody";ServiceAPI.Instance.util.log("id",b);ServiceAPI.Instance.util.log("tbl",a);this.adminAddTemplateRow(a,b)},adminAddTemplateRow:function(a,c){var b=this.renderRow(c,"","","","",false);ServiceAPI.Instance.util.log("rowTemplate",b);$(a).prepend(b)},currentDeleteId:null,deleteCRMNumberCampaignAction:function(){var a=ServiceAPI.Instance.services.crmService.currentDeleteId;ServiceAPI.Instance.util.log("modalDelete",a);ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaign(a);$("#modalDelete").modal({show:false})},testCRMNumberCampaign:function(b){var a=$("#referrer-"+b).val();document.location="/api/admin/test/?utm_content="+a},deleteCRMNumberCampaignDialog:function(a){this.currentDeleteId=a;$("#modalDelete").modal({show:true});$("#modal-delete-confirm").off("click",ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaignAction);$("#modal-delete-confirm").on("click",ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaignAction)},submitCRMNumberCampaignForm:function(c){var a=$("#active-"+c).is(":checked");if(a){a="1"}else{a="0"}var b={code:c,values:{id:c,active:a,number:$("#number-"+c).val(),referrer:$("#referrer-"+c).val(),display_name:$("#display_name-"+c).val()}};ServiceAPI.Instance.log("filter",b);this.setCRMNumberCampaign(b)},setCRMNumberCampaign:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+=""+a.code;b+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",b);$.post(b,a.values,function(c){ServiceAPI.Instance.util.log("data",c);ServiceAPI.Instance.util.log("data.msg",c.msg);ServiceAPI.Instance.util.log("data.code",c.code);ServiceAPI.Instance.util.log("data.data",c.data);ServiceAPI.Instance.util.log("data.info",c.info);ServiceAPI.Instance.util.log("data.action",c.action);if(c.code>0||c.code.length>1){$("#save-"+a.code).hide();ServiceAPI.Instance.util.log("ERRORS:setCRMNumberCampaign",true)}else{$("#save-"+a.code).hide();ServiceAPI.Instance.util.log("SUCCESS:setCRMNumberCampaign",false)}},"json")},deleteCRMNumberCampaign:function(f){var e=ServiceAPI.Instance.services.apiUrlRoot;e+="/crm/crm-number-campaign-meta/";e+=""+f+"/delete/";e+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",e);var d="deleteCRMNumberCampaign";var c=d+"-"+f+"-delete-crmauth";ServiceAPI.Instance.util.log("shortCodePrep",c);var b=ServiceAPI.Instance.util.shortCode(c);ServiceAPI.Instance.util.log("shortCode",b);var a={shortCode:b,auth:d};ServiceAPI.Instance.util.log("values",a);$.post(e,a,function(g){ServiceAPI.Instance.util.log("data",g);ServiceAPI.Instance.util.log("data.msg",g.msg);ServiceAPI.Instance.util.log("data.code",g.code);ServiceAPI.Instance.util.log("data.data",g.data);ServiceAPI.Instance.util.log("data.info",g.info);ServiceAPI.Instance.util.log("data.action",g.action);if(g.code>0||g.code.length>1){ServiceAPI.Instance.util.log("ERRORS:deleteCRMNumberCampaign",true)}else{ServiceAPI.Instance.util.log("SUCCESS:deleteCRMNumberCampaign",false);crm.crmAdmin()}},"json")},getCRMNumberByCampaignReferrer:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+="referrer/"+a.referrer;b+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",b);$.get(b,null,function(d){ServiceAPI.Instance.util.log("data",d);ServiceAPI.Instance.util.log("data.msg",d.msg);ServiceAPI.Instance.util.log("data.code",d.code);ServiceAPI.Instance.util.log("data.data",d.data);ServiceAPI.Instance.util.log("data.info",d.info);ServiceAPI.Instance.util.log("data.action",d.action);if(d.code>0||d.code.length>1){ServiceAPI.Instance.util.log("ERRORS:getCRMNumberByCampaignReferrer",true)}else{ServiceAPI.Instance.util.log("SUCCESS:getCRMNumberByCampaignReferrer",false);if(d.data){var c=d.data.number;var e=d.data.active;ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get",c,1);if(ServiceAPI.Instance.services.crmService.showValBool(e)){if(!ServiceAPI.Instance.util.isNullOrEmptyString(c)){$(a.el).html(c);if(!$(a.el).hasClass("crm-fade-in")){$(a.el).addClass("crm-fade-in")}ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get-active",c,1)}}}}},"json")},getCRMNumberByCampaignCode:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+="code/"+a.code;b+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",b);$.get(b,null,function(d){ServiceAPI.Instance.util.log("data",d);ServiceAPI.Instance.util.log("data.msg",d.msg);ServiceAPI.Instance.util.log("data.code",d.code);ServiceAPI.Instance.util.log("data.data",d.data);ServiceAPI.Instance.util.log("data.info",d.info);ServiceAPI.Instance.util.log("data.action",d.action);if(d.code>0||d.code.length>1){ServiceAPI.Instance.util.log("ERRORS:getCRMNumberByCampaignCode",true)}else{ServiceAPI.Instance.util.log("SUCCESS:getCRMNumberByCampaignCode",false);if(d.data){var c=d.data.number;var e=d.data.active;ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get",c,1);if(ServiceAPI.Instance.services.crmService.showValBool(e)){if(!ServiceAPI.Instance.util.isNullOrEmptyString(c)){$(a.el).html(c);if(!$(a.el).hasClass("crm-fade-in")){$(a.el).addClass("crm-fade-in")}ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get-active",c,1)}}}}},"json")},getCRMNumberCampaignMeta:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+="?range="+a.rangeType;b+="&page="+a.page;b+="&page-size="+a.pageSize;if(a.username){b+="&code="+a.code}b+="&format=json&callback=?";this.filter=a;ServiceAPI.Instance.log("serviceUrl:",b);$.get(b,null,this.getCRMNumberCampaignMetaCallback,"json")},getCRMNumberCampaignMetaCallback:function(b){var c=ServiceAPI.Instance.services.crmService;var a=ServiceAPI.Instance.util.log;a("data",b);a("data.msg",b.msg);a("data.code",b.code);a("data.data",b.data);a("data.info",b.info);a("data.action",b.action);if(b.code>0||b.code.length>1){ServiceAPI.Instance.log("ERRORS:getCRMNumberCampaignMetaCallback",true)}else{ServiceAPI.Instance.log("SUCCESS:getCRMNumberCampaignMetaCallback",false);c.renderResponse(c.filter,b)}}})}),initialize:function(){ServiceAPI.Instance=this;this.Instance=this;this.initLibs();this.util=new this.Utility();this.profile=new this.Profile();this.profile.initAttributes();this.tracker=new this.Tracker();this.services=new this.Services();this.services.profileService=new this.services.ProfileService();this.services.crmService=new this.services.CRMService();this.controllers=new this.Controllers();this.controllers.uiController=new this.controllers.UIController();this.startUp();this.log("started up ServiceAPI")},startUp:function(){$("html").bind("tapone",this.controllers.uiController.eventHandlerTapOne);$("html").bind("taptwo",this.controllers.uiController.eventHandlerTapTwo);$("html").bind("tapthree",this.controllers.uiController.eventHandlerTapThree);$("html").bind("tapfour",this.controllers.uiController.eventHandlerTapFour);$("html").bind("swipeone",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipetwo",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipethree",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipefour",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipeup",this.controllers.uiController.eventHandlerSwipeUp);$("html").bind("swiperightup",this.controllers.uiController.eventHandlerSwipeRightUp);$("html").bind("swiperight",this.controllers.uiController.eventHandlerSwipeRight);$("html").bind("swiperightdown",this.controllers.uiController.eventHandlerSwipeRightDown);$("html").bind("swipedown",this.controllers.uiController.eventHandlerSwipeDown);$("html").bind("swipeleftdown",this.controllers.uiController.eventHandlerSwipeLeftDown);$("html").bind("swipeleft",this.controllers.uiController.eventHandlerSwipeLeft);$("html").bind("swipeleftup",this.controllers.uiController.eventHandlerSwipeLeftUp);$("html").bind("pinchopen",this.controllers.uiController.eventHandlerPinchOpen);$("html").bind("pinchclose",this.controllers.uiController.eventHandlerPinchClose);$("html").bind("rotatecw",this.controllers.uiController.eventHandlerRotateCW);$("html").bind("rotateccw",this.controllers.uiController.eventHandlerRotateCCW);$("html").bind("swipeone",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipemove",this.controllers.uiController.eventHandlerSwipeMove);$("html").bind("pinch",this.controllers.uiController.eventHandlerPinch);$("html").bind("rotate",this.controllers.uiController.eventHandlerRotate);$(".card .front").append('<span class="flip_back"></span>');$(".card .back").append('<span class="flip_front"></span>');this.controllers.uiController.initHistoryState()},log:function(a,b){if(window.console){console.log(a,b)}},hasProfileAttribute:function(a){return ServiceAPI.Instance.profile.hasAttribute(a)},getProfileAttribute:function(a){return ServiceAPI.Instance.profile.getAttribute(a)},setProfileAttribute:function(a,b){return ServiceAPI.Instance.profile.setAttribute(a,b)},syncCRMReferrer:function(){var b=$.query.get("utm_content");if(ServiceAPI.Instance.util.isNullOrEmptyString(b)){b="";ServiceAPI.Instance.tracker.trackEventCRM("referrer","no-referrer-or-inner-page",1);var c=this.getProfileAttribute("utm_content");if(ServiceAPI.Instance.util.isNullOrEmptyString(c)){ServiceAPI.Instance.tracker.trackEventCRM("referrer-return",c,1)}}else{ServiceAPI.Instance.log("updatingReferrer:",b);var a=ServiceAPI.Instance.util.shortCode(b);this.setProfileAttribute("crm-code",a);this.setProfileAttribute("utm_content",b);ServiceAPI.Instance.tracker.trackEventCRM("shortCode",a,1);ServiceAPI.Instance.tracker.trackEventCRM("referrer-landed",b,1)}return b},updateCRMNumberCampaigns:function(){var a=[".crm-number"];this.updateCRMNumberCampaignTags(a)},updateCRMNumberCampaignTags:function(b){var f="data-crm-type";var c="data-crm-code";var h="data-crm-referrer";var e="crm-code";var j="";var d="";var g=this.syncCRMReferrer();d=g;if(this.hasProfileAttribute(e)){j=this.getProfileAttribute(e);ServiceAPI.Instance.tracker.trackEventCRM("return-user-code",j,1);ServiceAPI.Instance.tracker.trackEventCRM("return-user-referrer",g,1)}else{ServiceAPI.Instance.tracker.trackEventCRM("new-user-code","none",1);ServiceAPI.Instance.tracker.trackEventCRM("new-user-referrer",g,1)}for(var a=0;a<b.length;a++){$(b[a]).each(function(m){var o=b[a];var p=$(this).html();var l=$(this).attr(f);var t=$(this).attr(c);var s=$(this).attr(h);ServiceAPI.Instance.tracker.trackEventCRM("dynamic-tag-update",o,1);ServiceAPI.Instance.log("crm:----------------","");ServiceAPI.Instance.log("crm:currentDataNumber",p);ServiceAPI.Instance.log("crm:currentDataType",l);ServiceAPI.Instance.log("crm:currentDataCode",t);ServiceAPI.Instance.log("crm:currentDataReferrer",s);var n=false;var q=false;var k=false;if(!ServiceAPI.Instance.util.isNullOrEmptyString(l)){if(l.toLowerCase()=="override"){n=true}}ServiceAPI.Instance.log("crm:isOverride",n);if(!n){q=true}else{if(!ServiceAPI.Instance.util.isNullOrEmptyString(t)){j=t;q=true}else{if(!ServiceAPI.Instance.util.isNullOrEmptyString(s)){d=s;k=true}}}if(!q){if(!$(o).hasClass("crm-fade-in")){$(o).addClass("crm-fade-in")}}if(q){if(!ServiceAPI.Instance.util.isNullOrEmptyString(j)){ServiceAPI.Instance.log("crm:updatingNumber:currentCode:",j);var r={code:j,el:this};ServiceAPI.Instance.log("crm:numberFilter",r);ServiceAPI.Instance.services.crmService.getCRMNumberByCampaignCode(r)}}if(k){if(!ServiceAPI.Instance.util.isNullOrEmptyString(d)){ServiceAPI.Instance.log("crm:updatingNumber:currentReferrer:",d);var r={referrer:d,el:this};ServiceAPI.Instance.log("crm:numberFilter",r);ServiceAPI.Instance.services.crmService.getCRMNumberByCampaignReferrer(r)}}})}},jQueryLoaded:function(){if(typeof jQuery=="undefined"){if(typeof $=="function"){return true}}else{return true}return false},getScript:function(c,e){var b=document.createElement("script");b.src=c;var d=document.getElementsByTagName("head")[0],a=false;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){a=true;e();b.onload=b.onreadystatechange=null;d.removeChild(b)}};d.appendChild(b)},initLibs:function(){if(this.jQueryLoaded()){return true}var a=false;this.getScript("//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",function(){if(typeof jQuery=="undefined"){a=false}else{a=true}});this.getScript("//code.jquery.com/jquery-migrate-1.1.0.min.js",function(){if(typeof jQuery=="undefined"){a=false}else{a=true}});return a}});var LoaderHelper=Class({Instance:function(){return this},log:function(a,b){if(window.console){console.log(a,b)}},initialize:function(a){this.log("started up LoaderHelper");this.initLibs(a)},jQueryLoaded:function(){this.log("initLibs: jQueryLoaded");if(typeof jQuery=="undefined"){this.log("initLibs: jQuery undefined");if(typeof $=="function"){this.log("initLibs: $ exists");this.log("initLibs: jQueryLoaded true");return true}else{this.log("initLibs: jQueryLoaded false");return false}}else{this.log("initLibs: jQueryLoaded true");if(typeof $=="function"){this.log("initLibs: $ exists");this.log("initLibs: jQueryLoaded true");return true}else{this.log("initLibs: $ updated");$=jQuery;return true}}this.log("initLibs: jQueryLoaded false");return false},getScript:function(c,e){var b=document.createElement("script");b.src=c;var d=document.getElementsByTagName("head")[0],a=false;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){a=true;e();b.onload=b.onreadystatechange=null;d.removeChild(b)}};d.appendChild(b)},initLibs:function(a){if(this.jQueryLoaded()){this.log("initLibs: jquery IS loaded");a();return true}this.log("initLibs: jquery not loaded");var b=false;this.getScript("//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",function(){if(typeof jQuery=="undefined"){b=false}else{b=true;this.log("initLibs: jquery load:"+b);this.getScript("//code.jquery.com/jquery-migrate-1.1.0.min.js",function(){if(typeof jQuery=="undefined"){b=false}else{b=true;a()}});this.log("initLibs: jquery migrate load:"+b)}});return b}});var Class=function(b){var a=function(){this.initialize.apply(this,arguments)};for(var c in b){a.prototype[c]=b[c]}if(!a.prototype.initialize){a.prototype.initialize=function(){}}return a};
/*!
 * A crc32 function that will produce the same result as PHP's crc32() function
 * (http://php.net/crc32).
 *
 * The string used in PHP must be encoded in UTF-8 or the checksums will be
 * different. Use the following PHP to get the unsigned integer result:
 *
 *     sprintf('%u', crc32($string));
 *
 * Copyright 2010, Will Bond <will@wbond.net>
 * Released under the MIT license
 */
(function(){var a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];crc32=function(c){c=unescape(encodeURI(c));var e=0^(-1);var b=c.length;for(var d=0;d<b;d++){e=(e>>>8)^a[(e^c.charCodeAt(d))&255]}e=e^(-1);if(e<0){e+=4294967296}return e}})();var qs=(function(d){if(d==""){return{}}var c={};for(var e=0;e<d.length;++e){var f=d[e].split("=");if(f.length!=2){continue}c[f[0]]=decodeURIComponent(f[1].replace(/\+/g," "))}return c})(window.location.search.substr(1).split("&"));new function(e){var d=e.separator||"&";var c=e.spaces===false?false:true;var a=e.suffix===false?"":"[]";var g=e.prefix===false?false:true;var b=g?e.hash===true?"#":"?":"";var f=e.numbers===false?false:true;jQuery.query=new function(){var h=function(n,m){return n!=undefined&&n!==null&&(!!m?n.constructor==m:true)};var j=function(s){var n,r=/\[([^[]*)\]/g,o=/^(\S+?)(\[\S*\])?$/.exec(s),p=o[1],q=[];while(n=r.exec(o[2])){q.push(n[1])}return[p,q]};var l=function(t,s,r){var u,q=s.shift();if(typeof t!="object"){t=null}if(q===""){if(!t){t=[]}if(h(t,Array)){t.push(s.length==0?r:l(null,s.slice(0),r))}else{if(h(t,Object)){var p=0;while(t[p++]!=null){}t[--p]=s.length==0?r:l(t[p],s.slice(0),r)}else{t=[];t.push(s.length==0?r:l(null,s.slice(0),r))}}}else{if(q&&q.match(/^\s*[0-9]+\s*$/)){var n=parseInt(q,10);if(!t){t=[]}t[n]=s.length==0?r:l(t[n],s.slice(0),r)}else{if(q){var n=q.replace(/^\s*|\s*$/g,"");if(!t){t={}}if(h(t,Array)){var m={};for(var p=0;p<t.length;++p){m[p]=t[p]}t=m}t[n]=s.length==0?r:l(t[n],s.slice(0),r)}else{return r}}}return t};var k=function(m){var n=this;n.keys={};if(m.queryObject){jQuery.each(m.get(),function(o,p){n.SET(o,p)})}else{jQuery.each(arguments,function(){var o=""+this;o=decodeURIComponent(o);o=o.replace(/^[?#]/,"");o=o.replace(/[;&]$/,"");if(c){o=o.replace(/[+]/g," ")}jQuery.each(o.split(/[&;]/),function(){var p=this.split("=")[0];var q=this.split("=")[1];if(!p){return}if(f){if(/^[+-]?[0-9]+\.[0-9]*$/.test(q)){q=parseFloat(q)}else{if(/^[+-]?[0-9]+$/.test(q)){q=parseInt(q,10)}}}q=(!q&&q!==0)?true:q;if(q!==false&&q!==true&&typeof q!="number"){q=q}n.SET(p,q)})})}return n};k.prototype={queryObject:true,has:function(m,n){var o=this.get(m);return h(o,n)},GET:function(n){if(!h(n)){return this.keys}var m=j(n),o=m[0],q=m[1];var p=this.keys[o];while(p!=null&&q.length!=0){p=p[q.shift()]}return typeof p=="number"?p:p||""},get:function(m){var n=this.GET(m);if(h(n,Object)){return jQuery.extend(true,{},n)}else{if(h(n,Array)){return n.slice(0)}}return n},SET:function(n,s){var p=!h(s)?null:s;var m=j(n),o=m[0],r=m[1];var q=this.keys[o];this.keys[o]=l(q,r.slice(0),p);return this},set:function(m,n){return this.copy().SET(m,n)},REMOVE:function(m){return this.SET(m,null).COMPACT()},remove:function(m){return this.copy().REMOVE(m)},EMPTY:function(){var m=this;jQuery.each(m.keys,function(n,o){delete m.keys[n]});return m},load:function(m){var o=m.replace(/^.*?[#](.+?)(?:\?.+)?$/,"$1");var n=m.replace(/^.*?[?](.+?)(?:#.+)?$/,"$1");return new k(m.length==n.length?"":n,m.length==o.length?"":o)},empty:function(){return this.copy().EMPTY()},copy:function(){return new k(this)},COMPACT:function(){function m(p){var o=typeof p=="object"?h(p,Array)?[]:{}:p;if(typeof p=="object"){function n(s,q,r){if(h(s,Array)){s.push(r)}else{s[q]=r}}jQuery.each(p,function(q,r){if(!h(r)){return true}n(o,q,m(r))})}return o}this.keys=m(this.keys);return this},compact:function(){return this.copy().COMPACT()},toString:function(){var o=0,r=[],q=[],n=this;var m=function(s,t,u){if(!h(u)||u===false){return}var v=[encodeURIComponent(t)];if(u!==true){v.push("=");v.push(encodeURIComponent(u))}s.push(v.join(""))};var p=function(t,s){var u=function(v){return !s||s==""?[v].join(""):[s,"[",v,"]"].join("")};jQuery.each(t,function(v,w){if(typeof w=="object"){p(w,u(v))}else{m(q,u(v),w)}})};p(this.keys);if(q.length>0){r.push(b)}r.push(q.join(d));return r.join("")}};return new k(location.search,location.hash)}}(jQuery.query||{});var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){return this._utf8_decode(unescape(a))},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};var hexcase=0;var b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function any_hmac_sha1(a,c,b){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(c)),b)}function sha1_vm_test(){return hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),a.length*8))}function rstr_hmac_sha1(c,f){var e=rstr2binb(c);if(e.length>16){e=binb_sha1(e,c.length*8)}var a=Array(16),d=Array(16);for(var b=0;b<16;b++){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=binb_sha1(a.concat(rstr2binb(f)),512+f.length*8);return binb2rstr(binb_sha1(d.concat(g),512+160))}function rstr2hex(c){try{hexcase}catch(g){hexcase=0}var f=hexcase?"0123456789ABCDEF":"0123456789abcdef";var b="";var a;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);b+=f.charAt((a>>>4)&15)+f.charAt(a&15)}return b}function rstr2b64(c){try{b64pad}catch(h){b64pad=""}var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b="";var a=c.length;for(var f=0;f<a;f+=3){var k=(c.charCodeAt(f)<<16)|(f+1<a?c.charCodeAt(f+1)<<8:0)|(f+2<a?c.charCodeAt(f+2):0);for(var d=0;d<4;d++){if(f*8+d*6>c.length*8){b+=b64pad}else{b+=g.charAt((k>>>6*(3-d))&63)}}}return b}function rstr2any(k,c){var b=c.length;var j=Array();var h,a,l,e;var g=Array(Math.ceil(k.length/2));for(h=0;h<g.length;h++){g[h]=(k.charCodeAt(h*2)<<8)|k.charCodeAt(h*2+1)}while(g.length>0){e=Array();l=0;for(h=0;h<g.length;h++){l=(l<<16)+g[h];a=Math.floor(l/b);l-=a*b;if(e.length>0||a>0){e[e.length]=a}}j[j.length]=l;g=e}var d="";for(h=j.length-1;h>=0;h--){d+=c.charAt(j[h])}var f=Math.ceil(k.length*8/(Math.log(c.length)/Math.log(2)));for(h=d.length;h<f;h++){d=c[0]+d}return d}function str2rstr_utf8(c){var b="";var d=-1;var a,e;while(++d<c.length){a=c.charCodeAt(d);e=d+1<c.length?c.charCodeAt(d+1):0;if(55296<=a&&a<=56319&&56320<=e&&e<=57343){a=65536+((a&1023)<<10)+(e&1023);d++}if(a<=127){b+=String.fromCharCode(a)}else{if(a<=2047){b+=String.fromCharCode(192|((a>>>6)&31),128|(a&63))}else{if(a<=65535){b+=String.fromCharCode(224|((a>>>12)&15),128|((a>>>6)&63),128|(a&63))}else{if(a<=2097151){b+=String.fromCharCode(240|((a>>>18)&7),128|((a>>>12)&63),128|((a>>>6)&63),128|(a&63))}}}}}return b}function str2rstr_utf16le(b){var a="";for(var c=0;c<b.length;c++){a+=String.fromCharCode(b.charCodeAt(c)&255,(b.charCodeAt(c)>>>8)&255)}return a}function str2rstr_utf16be(b){var a="";for(var c=0;c<b.length;c++){a+=String.fromCharCode((b.charCodeAt(c)>>>8)&255,b.charCodeAt(c)&255)}return a}function rstr2binb(b){var a=Array(b.length>>2);for(var c=0;c<a.length;c++){a[c]=0}for(var c=0;c<b.length*8;c+=8){a[c>>5]|=(b.charCodeAt(c/8)&255)<<(24-c%32)}return a}function binb2rstr(b){var a="";for(var c=0;c<b.length*32;c+=8){a+=String.fromCharCode((b[c>>5]>>>(24-c%32))&255)}return a}function binb_sha1(v,o){v[o>>5]|=128<<(24-o%32);v[((o+64>>9)<<4)+15]=o;var y=Array(80);var u=1732584193;var s=-271733879;var r=-1732584194;var q=271733878;var p=-1009589776;for(var l=0;l<v.length;l+=16){var n=u;var m=s;var k=r;var h=q;var f=p;for(var g=0;g<80;g++){if(g<16){y[g]=v[l+g]}else{y[g]=bit_rol(y[g-3]^y[g-8]^y[g-14]^y[g-16],1)}var z=safe_add(safe_add(bit_rol(u,5),sha1_ft(g,s,r,q)),safe_add(safe_add(p,y[g]),sha1_kt(g)));p=q;q=r;r=bit_rol(s,30);s=u;u=z}u=safe_add(u,n);s=safe_add(s,m);r=safe_add(r,k);q=safe_add(q,h);p=safe_add(p,f)}return Array(u,s,r,q,p)}function sha1_ft(e,a,g,f){if(e<20){return(a&g)|((~a)&f)}if(e<40){return a^g^f}if(e<60){return(a&g)|(a&f)|(g&f)}return a^g^f}function sha1_kt(a){return(a<20)?1518500249:(a<40)?1859775393:(a<60)?-1894007588:-899497514}function safe_add(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)}function bit_rol(a,b){return(a<<b)|(a>>>(32-b))}
/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/
(function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(b,e){var g=a,d=[];e=e||g.length;if(b){for(var c=0;c<b;c++){d[c]=g[0|Math.random()*e]}}else{var f;d[8]=d[13]=d[18]=d[23]="-";d[14]="4";for(var c=0;c<36;c++){if(!d[c]){f=0|Math.random()*16;d[c]=g[(c==19)?(f&3)|8:f]}}}return d.join("")};Math.uuidFast=function(){var f=a,d=new Array(36),c=0,e;for(var b=0;b<36;b++){if(b==8||b==13||b==18||b==23){d[b]="-"}else{if(c<=2){c=33554432+(Math.random()*16777216)|0}e=c&15;c=c>>4;d[b]=f[(b==19)?(e&3)|8:e]}}return d.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=Math.random()*16|0,b=e=="x"?d:(d&3|8);return b.toString(16)}).toUpperCase()}})();
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(a,b){if(typeof exports==="object"&&exports){module.exports=b}else{if(typeof define==="function"&&define.amd){define(b)}else{a.Mustache=b}}}(this,(function(){var w={};w.name="mustache.js";w.version="0.7.2";w.tags=["{{","}}"];w.Scanner=u;w.Context=s;w.Writer=q;var d=/\s*/;var l=/\s+/;var h=/\S/;var g=/\s*=/;var n=/\s*\}/;var t=/#|\^|\/|>|\{|&|=|!/;var j=RegExp.prototype.test;var v=Object.prototype.toString;function o(z,y){return j.call(z,y)}function f(y){return !o(h,y)}var k=Array.isArray||function(y){return v.call(y)==="[object Array]"};function e(y){return y.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function m(y){return String(y).replace(/[&<>"'\/]/g,function(z){return c[z]})}w.escape=m;function u(y){this.string=y;this.tail=y;this.pos=0}u.prototype.eos=function(){return this.tail===""};u.prototype.scan=function(z){var y=this.tail.match(z);if(y&&y.index===0){this.tail=this.tail.substring(y[0].length);this.pos+=y[0].length;return y[0]}return""};u.prototype.scanUntil=function(z){var y,A=this.tail.search(z);switch(A){case -1:y=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:y="";break;default:y=this.tail.substring(0,A);this.tail=this.tail.substring(A);this.pos+=A}return y};function s(y,z){this.view=y;this.parent=z;this._cache={}}s.make=function(y){return(y instanceof s)?y:new s(y)};s.prototype.push=function(y){return new s(y,this)};s.prototype.lookup=function(y){var B=this._cache[y];if(!B){if(y=="."){B=this.view}else{var A=this;while(A){if(y.indexOf(".")>0){B=A.view;var C=y.split("."),z=0;while(B&&z<C.length){B=B[C[z++]]}}else{B=A.view[y]}if(B!=null){break}A=A.parent}}this._cache[y]=B}if(typeof B==="function"){B=B.call(this.view)}return B};function q(){this.clearCache()}q.prototype.clearCache=function(){this._cache={};this._partialCache={}};q.prototype.compile=function(A,y){var z=this._cache[A];if(!z){var B=w.parse(A,y);z=this._cache[A]=this.compileTokens(B,A)}return z};q.prototype.compilePartial=function(z,B,y){var A=this.compile(B,y);this._partialCache[z]=A;return A};q.prototype.getPartial=function(y){if(!(y in this._partialCache)&&this._loadPartial){this.compilePartial(y,this._loadPartial(y))}return this._partialCache[y]};q.prototype.compileTokens=function(A,z){var y=this;return function(B,D){if(D){if(typeof D==="function"){y._loadPartial=D}else{for(var C in D){y.compilePartial(C,D[C])}}}return p(A,y,s.make(B),z)}};q.prototype.render=function(A,y,z){return this.compile(A)(y,z)};function p(F,z,y,I){var C="";var A,G,H;for(var D=0,E=F.length;D<E;++D){A=F[D];G=A[1];switch(A[0]){case"#":H=y.lookup(G);if(typeof H==="object"){if(k(H)){for(var B=0,K=H.length;B<K;++B){C+=p(A[4],z,y.push(H[B]),I)}}else{if(H){C+=p(A[4],z,y.push(H),I)}}}else{if(typeof H==="function"){var J=I==null?null:I.slice(A[3],A[5]);H=H.call(y.view,J,function(L){return z.render(L,y)});if(H!=null){C+=H}}else{if(H){C+=p(A[4],z,y,I)}}}break;case"^":H=y.lookup(G);if(!H||(k(H)&&H.length===0)){C+=p(A[4],z,y,I)}break;case">":H=z.getPartial(G);if(typeof H==="function"){C+=H(y)}break;case"&":H=y.lookup(G);if(H!=null){C+=H}break;case"name":H=y.lookup(G);if(H!=null){C+=w.escape(H)}break;case"text":C+=G;break}}return C}function x(E){var z=[];var D=z;var F=[];var B;for(var A=0,y=E.length;A<y;++A){B=E[A];switch(B[0]){case"#":case"^":F.push(B);D.push(B);D=B[4]=[];break;case"/":var C=F.pop();C[5]=B[2];D=F.length>0?F[F.length-1][4]:z;break;default:D.push(B)}}return z}function a(D){var A=[];var C,z;for(var B=0,y=D.length;B<y;++B){C=D[B];if(C){if(C[0]==="text"&&z&&z[0]==="text"){z[1]+=C[1];z[3]=C[3]}else{z=C;A.push(C)}}}return A}function r(y){return[new RegExp(e(y[0])+"\\s*"),new RegExp("\\s*"+e(y[1]))]}w.parse=function(O,E){O=O||"";E=E||w.tags;if(typeof E==="string"){E=E.split(l)}if(E.length!==2){throw new Error("Invalid tags: "+E.join(", "))}var I=r(E);var A=new u(O);var G=[];var F=[];var D=[];var P=false;var N=false;function M(){if(P&&!N){while(D.length){delete F[D.pop()]}}else{D=[]}P=false;N=false}var B,z,H,J,C;while(!A.eos()){B=A.pos;H=A.scanUntil(I[0]);if(H){for(var K=0,L=H.length;K<L;++K){J=H.charAt(K);if(f(J)){D.push(F.length)}else{N=true}F.push(["text",J,B,B+1]);B+=1;if(J=="\n"){M()}}}if(!A.scan(I[0])){break}P=true;z=A.scan(t)||"name";A.scan(d);if(z==="="){H=A.scanUntil(g);A.scan(g);A.scanUntil(I[1])}else{if(z==="{"){H=A.scanUntil(new RegExp("\\s*"+e("}"+E[1])));A.scan(n);A.scanUntil(I[1]);z="&"}else{H=A.scanUntil(I[1])}}if(!A.scan(I[1])){throw new Error("Unclosed tag at "+A.pos)}C=[z,H,B,A.pos];F.push(C);if(z==="#"||z==="^"){G.push(C)}else{if(z==="/"){if(G.length===0){throw new Error('Unopened section "'+H+'" at '+B)}var y=G.pop();if(y[1]!==H){throw new Error('Unclosed section "'+y[1]+'" at '+B)}}else{if(z==="name"||z==="{"||z==="&"){N=true}else{if(z==="="){E=H.split(l);if(E.length!==2){throw new Error("Invalid tags at "+B+": "+E.join(", "))}I=r(E)}}}}}var y=G.pop();if(y){throw new Error('Unclosed section "'+y[1]+'" at '+A.pos)}F=a(F);return x(F)};var b=new q();w.clearCache=function(){return b.clearCache()};w.compile=function(z,y){return b.compile(z,y)};w.compilePartial=function(z,A,y){return b.compilePartial(z,A,y)};w.compileTokens=function(z,y){return b.compileTokens(z,y)};w.render=function(A,y,z){return b.render(A,y,z)};w.to_html=function(B,z,A,C){var y=w.render(B,z,A);if(typeof C==="function"){C(y)}else{return y}};return w}())));jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m=$.extend({},m);m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};var serviceApi=null;var ServiceAPI=Class({Instance:function(){return this},services:null,controllers:null,profile:null,tracker:null,Profile:Class({geo:null,uuid:null,localAttributeCodes:{serviceApiAtts:"serviceApiAtts",geoLat:"geoLat",geoLong:"geoLong",colorBackgroundHighlight:"colorBackgroundHighlight",colorHighlight:"colorHighlight"},localAttributes:null,getLocation:function(){},initAttributes:function(){if(this.localAttributes==null){this.localAttributes=JSON.parse($.cookie(this.localAttributeCodes.serviceApiAtts))}if(this.localAttributes==null){this.localAttributes={}}},hasAttribute:function(a){this.initAttributes();if(this.localAttributes!=null){if(this.localAttributes[a]!=null){if(!ServiceAPI.Instance.util.isNullOrEmptyString(a)){return true}}}return false},getAttribute:function(a){var b=null;this.initAttributes();if(this.hasAttribute(a)){b=this.localAttributes[a]}return b},setAttribute:function(a,b){this.initAttributes();this.localAttributes[a]=b;$.cookie(this.localAttributeCodes.serviceApiAtts,JSON.stringify(this.localAttributes),{expires:7,path:"/"})},setCustomColorHighlight:function(a){this.setAttribute(this.localAttributeCodes.colorHighlight,a)},getCustomColorHighlight:function(){return this.getAttribute(this.localAttributeCodes.colorHighlight)},setCustomColorBackgroundHighlight:function(a){this.setAttribute(this.localAttributeCodes.colorBackgroundHighlight,a)},getCustomColorBackgroundHighlight:function(){return this.getAttribute(this.localAttributeCodes.colorBackgroundHighlight)},setGeoLat:function(a){this.setAttribute(this.localAttributeCodes.geoLat,a)},getGeoLat:function(){return this.getAttribute(this.localAttributeCodes.geoLat)},setGeoLong:function(a){this.setAttribute(this.localAttributeCodes.geoLong,a)},getGeoLong:function(){return this.getAttribute(this.localAttributeCodes.geoLong)},loginFacebook:function(){}}),Tracker:Class({setAccount:function(a){try{if(ga){ga("create",a)}}catch(b){}try{if(!ServiceAPI.Instance.util.isNullOrEmpty(_gaq)){_gaq.push(["_setAccount",a])}}catch(b){}},trackPageView:function(a){try{if(ga){ga("send","pageview")}}catch(b){}try{if(!ServiceAPI.Instance.util.isNullOrEmpty(_gaq)){_gaq.push(["_trackPageview",a])}}catch(b){}},trackEvent:function(b,c,f,a){try{if(ga){if(ServiceAPI.Instance.util.isNullOrEmptyString(f)){f="default"}if(ServiceAPI.Instance.util.isNullOrEmptyString(a)){a=1}ga("send","event",b,c,f,a);ServiceAPI.Instance.util.log("trackEvent:ga:"," category:"+b+" action:"+c+" opt_label:"+f+" opt_value:"+a)}}catch(d){}try{if(!ServiceAPI.Instance.util.isNullOrEmpty(_gaq)){_gaq.push(["_trackEvent",b,c,f,a]);ServiceAPI.Instance.util.log("trackEvent:gaq:"," category:"+b+" action:"+c+" opt_label:"+f+" opt_value:"+a)}}catch(d){}},trackEventCRM:function(b,a,c){ServiceAPI.Instance.tracker.trackEvent("crm-number-campaign:"+b,b+":"+a,a,1)}}),Utility:Class({log:function(a,b){if(window.console){console.log(a,b)}},renderWrapTagStyles:function(a,c,b){return"<"+a+' class="'+b+'">'+c+"</"+a+">"},renderWrapTagStylesId:function(a,c,b,d){return"<"+a+' id="'+d+'" class="'+b+'">'+c+"</"+a+">"},renderWrapTag:function(a,b){return"<"+a+">"+b+"</"+a+">"},formatDatePrettyString:function(a){return moment(a,"YYYY-MM-DDTHH:mm:ss.SSS Z").fromNow()},isNullOrEmptyString:function(a){if(a==null||a==""||a=="undefined"){return true}return false},isNullOrEmpty:function(a){if((a==null||a==""||a=="undefined")&&a!=false){return true}return false},stripToAlphanumerics:function(a){a=a.replace(/[^\w\s]|/g,"");return a},toLower:function(a){return a.toLowerCase()},filterToUrlFormat:function(a){a=this.strip_to_alphanumerics(a);a=this.to_lower(a);a=a.replace("_","-");a=a.replace(" ","-");return a},getObjectValue:function(b,a){if(!this.isNullOrEmpty(b)){if(!isNullOrEmpty(b[a])){return b[a]}}return""},fillObjectValue:function(a,c,b,d){if(!this.isNullOrEmpty(c[b])){if(b!="div"){a+=d+c[b]}}return a},getUrlParamValue:function(a,c){var d="";if(a.indexOf(c+"/")>-1){var e=a.split("/");for(var b=0;b<e.length;b++){if(e[b]==c){if(e[b+1]!=null){d=e[b+1]}}}}return d},changeUrlToState:function(b,f,d){var c="";if(b.indexOf(f)>-1){var a=b.split(this.param_value_separator);for(var e=0;e<a.length;e++){if(a[e]==f){a[e+1]=d}}c=a.join(this.param_value_separator)}else{if(b.indexOf(f+this.param_value_separator)==-1){if(b.lastIndexOf(this.param_value_separator)==b.length-1){b=b.substr(0,b.length-1)}c=b+this.param_value_separator+f+this.param_value_separator+d}}return c},endsWithSlash:function(a){return a.match(/\/$/)},isAbsoluteUrl:function(a){var b=/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi;return this.regexMatch(a,b)},regexMatch:function(a,d){var c=new RegExp(d);var b=a;if(b.match(c)){return true}else{return false}},baseEncode:function(b,a){return(b).toString(a)},baseDecode:function(b,a){return parseInt(b,a)},base36Encode:function(a){return this.baseEncode(a,36)},base36Decode:function(a){return this.baseEncode(a,36)},base64Encode:function(a){return this.baseEncode(a,64)},shortCode:function(a){return this.base36Encode(crc32(b64_sha1(a)+"="))},loadContent:function(b,a){if($(b)!=null){$(b).load(a,function(){ServiceAPI.Instance.log("Content Loaded: "+b+" url:"+a)})}}}),Controllers:Class({uiController:null,apiController:null,UIController:Class({screenHeight:null,screenWidth:null,fpsLabel:null,offscreenLeft:-3500,offscreenRight:-3500,offscreenTop:-3500,offscreenBottom:50000,profileBackground:"light",profilColor:"red",currentPanel:"",currentEffect:"wave-top-left",currentViewData:{section:"map",elevation:"country",tileData:[],title:"Select a Region",description:"Select a Region",code:"us",displayCode:"US"},customBrandedBackgroundItems:["#tile-settings","#tile-overlay-info",".panel-results-tile","#panel-info-header","#tile-search","#tile-brand","#tile-logo"],customBrandedItems:["#title-section"],customColorBackgroundClasses:["color-background-brand-red","color-background-brand-pink","color-background-brand-lightblue","color-background-brand-darkblue","color-background-brand-teal"],customColorClasses:["color-brand-red","color-brand-pink","color-brand-lightblue","color-brand-darkblue","color-brand-teal"],initialize:function(){},setContext:function(b,a){$("#title-section").text(b);$("#tile-indicator").text(a)},togglePanel:function(a){if($(a).hasClass("closed-right")){hidePanel(a)}else{showPanel(a)}},showPanel:function(a){if($(a).hasClass("closed-right")){$(a).removeClass("closed-right")}},hidePanel:function(a){if(!$(a).hasClass("closed-right")){$(a).addClass("closed-right")}},presentPanel:function(a){this.hidePanel("#panel-login");this.hidePanel("#panel-login");if(a!="settings"){this.hidePanel("#panel-settings")}if(a!="login"){this.hidePanel("#panel-login")}if(a!="info"){this.hidePanel("#panel-info")}if(a!="results"){this.hidePanel("#panel-results")}if(a!="filters"){this.hidePanel("#panel-filters")}if(this.currentPanel==a){this.hidePanel("#panel-"+a);this.currentPanel="";return}ServiceAPI.Instance.log("presentPanel","#panel-"+a);this.showPanel("#panel-"+a);this.currentPanel=a},toggleSettings:function(){this.togglePanel("#panel-settings")},toggleResults:function(){this.togglePanel("#panel-results")},toggleInfo:function(){this.togglePanel("#panel-info")},toggleFilters:function(){this.togglePanel("#panel-filters")},showSettings:function(){this.showPanel("#panel-settings")},showResults:function(){this.showPanel("#panel-results")},showInfo:function(){this.showPanel("#panel-info")},showFilters:function(){this.showPanel("#panel-filters")},hideSettings:function(){this.hidePanel("#panel-settings")},hideResults:function(){this.hidePanel("#panel-results")},hideInfo:function(){this.hidePanel("#panel-info")},hideFilters:function(){this.hidePanel("#panel-filters")},adjustCurrentLayoutToScreen:function(){this.screenHeight=$(window).height();this.screenWidth=$(window).width()},applyClass:function(b,a){if(!$(b).hasClass(a)){$(b).addClass(a)}},removeClass:function(b,a){if($(b).hasClass(a)){$(b).removeClass(a)}},changeCSS:function(d,b,c){var e=null;if(document.getElementById){e="cssRules"}if(e){for(var a=0;a<document.styleSheets[0][e].length;a++){if(document.styleSheets[0][e][a].selectorText==d){document.styleSheets[0][e][a].style[b]=c}}}},toggleLoginContainer:function(){if($("#login-container .card").hasClass("flip")){$("#login-container .card").removeClass("flip")}else{$("#login-container .card").addClass("flip")}},initColors:function(){ServiceAPI.Instance.log("initColors","");this.applyClass("html","color-background-light");this.applyClass("body","color-background-light");this.applyClass("#tile-settings","color-light");this.applyClass("#tile-search","color-light");this.applyClass("#tile-brand","color-highlight");this.applyClass("#tile-indicator","color-background-black");this.applyClass("#tile-indicator","color-light");this.applyClass(".panel-background","color-background-dark");this.applyClass(".panel-background","opacity90");this.applyClass(".panel-background-overlay","color-background-light");this.applyClass(".panel-background-overlay","opacity90");this.profileColor=ServiceAPI.Instance.profile.getCustomColorHighlight();this.profileBackground=ServiceAPI.Instance.profile.getCustomColorBackgroundHighlight();if(this.profileColor==null){this.profileColor="red"}if(this.profileBackground==null){this.profileBackground="light"}this.changeBackground(this.profileBackground);this.changeHighlight(this.profileColor)},initDev:function(){},initCustomElements:function(){},changeSection:function(a,g,e,d,f,c,b,h){this.currentViewData.url=a;this.currentViewData.title=g;this.currentViewData.description=e;this.currentViewData.code=d;this.currentViewData.section=f;this.currentViewData.elevation=c;this.currentViewData.tileData=h;this.currentViewData.displayCode=b;this.pushHistoryState(this.currentViewData,g,a);this.loadHistoryState(this.currentViewData)},loadHistoryState:function(a){if(a!=null){this.setContext(a.title,a.displayCode.toUpperCase());ServiceAPI.Instance.controllers.templateController.currentMapLevel=a.elevation;ServiceAPI.Instance.controllers.templateController.currentMapCode=a.code}else{ServiceAPI.Instance.log("viewData was null")}ServiceAPI.Instance.controllers.canvasController.drawMap()},pushHistoryState:function(b,c,a){if(Modernizr.history){history.pushState(b,c,a)}},initHistoryState:function(){window.onpopstate=function(a){ServiceAPI.Instance.log("pathname: "+location.pathname)}},initPlacement:function(){},changeBackground:function(a){ServiceAPI.Instance.log("changing highlight to:"+a);ServiceAPI.Instance.profile.setCustomColorBackgroundHighlight(a);this.profileBackground=a;if(a=="light"){this.removeClass("html","color-background-highlight");this.removeClass("body","color-background-highlight");this.removeClass("#tile-indicator","color-background-light");this.removeClass("#tile-indicator","color-dark");this.removeClass("#panel-results-header","color-background-light");this.removeClass("#panel-results-header","color-dark");this.applyClass("html","color-background-light");this.applyClass("body","color-background-light");this.applyClass("#tile-indicator","color-background-black");this.applyClass("#tile-indicator","color-light");this.applyClass("#panel-results-header","color-background-black");this.applyClass("#panel-results-header","color-light")}else{this.removeClass("html","color-background-light");this.removeClass("body","color-background-light");this.removeClass("#tile-indicator","color-background-black");this.removeClass("#tile-indicator","color-light");this.removeClass("#panel-results-header","color-background-black");this.removeClass("#panel-results-header","color-light");this.applyClass("html","color-background-dark");this.applyClass("body","color-background-dark");this.applyClass("#tile-indicator","color-background-light");this.applyClass("#tile-indicator","color-dark");this.applyClass("#panel-results-header","color-background-light");this.applyClass("#panel-results-header","color-dark")}},removeCurrentBackgroundHighlights:function(){for(var b=0;b<this.customBrandedBackgroundItems.length;b++){ServiceAPI.Instance.log("customBrandedBackgroundItems:",this.customBrandedBackgroundItems[b]);for(var a=0;a<this.customColorBackgroundClasses.length;a++){ServiceAPI.Instance.log("customColorBackgroundClasses:",this.customColorBackgroundClasses[a]);this.removeClass(this.customBrandedBackgroundItems[b],this.customColorBackgroundClasses[a])}}},removeCurrentColorHighlights:function(){for(var b=0;b<this.customBrandedItems.length;b++){ServiceAPI.Instance.log("customBrandedItems:",this.customBrandedItems[b]);for(var a=0;a<this.customColorClasses.length;a++){ServiceAPI.Instance.log("customColorClasses:",this.customColorClasses[a]);this.removeClass(this.customBrandedItems[b],this.customColorClasses[a])}}},applyBackgroundHighlights:function(c){for(var a=0;a<this.customBrandedBackgroundItems.length;a++){var b="color-background-brand-"+c;ServiceAPI.Instance.log("colorToClass:",b);ServiceAPI.Instance.log("customBrandedBackgroundItems[i]:",this.customBrandedBackgroundItems[a]);this.applyClass(this.customBrandedBackgroundItems[a],b)}},applyColorHighlights:function(c){for(var a=0;a<this.customBrandedItems.length;a++){var b="color-brand-"+c;ServiceAPI.Instance.log("colorToClass:",b);ServiceAPI.Instance.log("customBrandedItems[i]:",this.customBrandedItems[a]);this.applyClass(this.customBrandedItems[a],b)}},changeHighlight:function(a){if(a=="red"||a=="lightblue"||a=="darkblue"||a=="pink"||a=="teal"){ServiceAPI.Instance.log("changing highlight to:",a);this.removeCurrentColorHighlights();this.removeCurrentBackgroundHighlights();this.applyBackgroundHighlights(a);this.applyColorHighlights(a);ServiceAPI.Instance.profile.setCustomColorHighlight(a)}},loadContentAll:function(a){$.getJSON(a,{cid:a,format:"json"},function(b){$.each(b,function(c,d){$(c).html(d)});$("#loading").hide()})},loadContentStart:function(){ServiceAPI.Instance.util.loadContent("#tile-login","/account/loginstart")},changeSectionData:function(c,a){var b=ServiceAPI.Instance.controllers.templateController.getTemplateDataItem(c,a);this.changeSection(b.url,b.displayName,b.displayName,b.code,"map",c,b.displayCode,b)},initTempTemplateButtons:function(){$(".transition-effect").on("click",function(a){ServiceAPI.Instance.log("click",this.id);ServiceAPI.Instance.controllers.uiController.currentEffect=this.id.replace("transition-","");ServiceAPI.Instance.controllers.uiController.changeSectionData(ServiceAPI.Instance.controllers.templateController.currentMapLevel,ServiceAPI.Instance.controllers.templateController.currentMapCode);a.preventDefault()})},adjustCurrentLayout:function(){setTimeout(this.adjustCurrentLayoutDelayed,2000)},adjustCurrentLayoutDelayed:function(){this.adjustCurrentLayout();if(ServiceAPI.Instance.controllers.canvasController.stage){ServiceAPI.Instance.controllers.canvasController.stage.clear()}ServiceAPI.Instance.controllers.canvasController.resizeCanvas()},eventHandlerClick:function(a){},eventHandlerTapOne:function(a){},eventHandlerTapTwo:function(a){},eventHandlerTapThree:function(a){},eventHandlertapFour:function(a){},eventHandlerSwipeOne:function(a){},eventHandlerSwipeTwo:function(a){},eventHandlerSwipeThree:function(a){},eventHandlerSwipeFour:function(a){},eventHandlerSwipeUp:function(a){},eventHandlerSwipeRightUp:function(a){},eventHandlerSwipeRight:function(a){},eventHandlerSwipeDown:function(a){},eventHandlerSwipeLeftDown:function(a){},eventHandlerSwipeLeft:function(a){},eventHandlerSwipeLeftUp:function(a){},eventHandler:function(a){},eventHandlerPinchOpen:function(a){},eventHandlerPinchClose:function(a){},eventHandlerRotateCW:function(a){},eventHandlerRotateCCW:function(a){},eventHandlerSwipeMove:function(a){},eventHandlerPinch:function(a){},eventHandlerRotate:function(a){}})}),Services:Class({apiUrlRoot:"/api/api",profileService:null,platformService:null,crmService:null,initialize:function(){ServiceAPI.Instance.util.log("initialized services",true)},log:function(a,b){if(window.console){console.log(a,b)}},ProfileService:Class({initialize:function(){ServiceAPI.Instance.log("initialized profile",true)},render:function(a){this.getProfile(a)},renderResponse:function(a,d){var c="all";var g=1;var h=200;if(a.rangeType){c=a.rangeType}if(a.page){g=a.page}if(a.pageSize){h=a.pageSize}var e="";var f="";var k="";f+='<table id="item-container" class="table">';f+=" <tr>";f+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Value","head-item item-head-value");f+=" </tr>";for(i=0;i<d.data.length;i++){f+=" <tr>";f+=ServiceAPI.Instance.util.renderWrapTagStyles("td",d.data[i].value_formatted,"item item-value");f+=" </tr>"}f+="</table>";var j={profileType:{code:"user",type:"string"},formatted:function(){return this.profileType.type},view_data:d};var b=Mustache.render(f,j);$(a.div).html(b)},getProfile:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/profile/"+a.code;b+="?range="+a.rangeType;b+="&page="+a.page;b+="&page-size="+a.pageSize;if(a.username){b+="&username="+a.username}b+="&format=json&callback=?";this.filter=a;ServiceAPI.Instance.log("serviceUrl:",b);$.get(b,null,this.getProfileCallback,"json")},getProfileCallback:function(b){var c=ServiceAPI.Instance.services.profile;var a=ServiceAPI.Instance.util.log;a("data",b);a("data.msg",b.msg);a("data.code",b.code);a("data.data",b.data);a("data.info",b.info);a("data.action",b.action);if(b.code>0||b.code.length>1){ServiceAPI.Instance.log("ERRORS:getProfileCallback",true)}else{ServiceAPI.Instance.log("SUCCESS:getProfileCallback",false);c.renderResponse(c.filter,b.data)}}}),CRMService:Class({filter:null,initialize:function(){ServiceAPI.Instance.log("initialized crm",true)},showVal:function(a){if(!ServiceAPI.Instance.util.isNullOrEmpty(a)){return a}return""},showValBool:function(a){if(a==undefined||a==null){return false}if(a==true||a=="true"||a==1||a=="1"){return true}return false},getPlaceholderText:function(a){var b="Type something...";if(a.indexOf("number")>-1){b="Phone Number"}else{if(a.indexOf("referrer")>-1){b="Campaign code"}else{if(a.indexOf("display_name")>-1){b="Description"}}}return b},blurEventRow:function(a){this.setShortCode(a)},changeEventRow:function(a){ServiceAPI.Instance.util.log("changeEventRow:id",a);$("#save-"+a).show();ServiceAPI.Instance.services.crmService.setShortCode(a);ServiceAPI.Instance.services.crmService.submitCRMNumberCampaignForm(a)},setShortCode:function(c){var a=$("#referrer-"+c).val();if(ServiceAPI.Instance.util.isNullOrEmptyString(a)){a="0"}var b=ServiceAPI.Instance.util.shortCode(a);$("#code-"+c).html(b)},getChangeEvent:function(c,a){var b="ServiceAPI.Instance.services.crmService.changeEventRow('"+c+"')";if(a.indexOf("number")>-1){}else{if(a.indexOf("referrer")>-1){}else{if(a.indexOf("display_name")>-1){}}}return b},showValCheckbox:function(f,a,e){var b="";if(this.showValBool(e)){b="checked"}var c=this.getChangeEvent(f,a);var d=this.getPlaceholderText(a);return'<input placeholder="'+d+'" onchange="'+c+'" type="checkbox" id="'+a+'" name="'+a+'" '+b+">"},showValInput:function(f,a,d){var e=this.blurEventRow(f);var b=this.getChangeEvent(f,a);var c=this.getPlaceholderText(a);return'<input type="text" placeholder="'+c+'" onchange="'+b+'"  onblur="'+e+'" class="table-cell-input" id="'+a+'" name="'+a+'" value="'+d+'">'},showValText:function(f,a,d){var e=this.blurEventRow(f);var b=this.getChangeEvent(f,a);var c=this.getPlaceholderText(a);return'<textarea  placeholder="'+c+'" onchange="'+b+'"  onblur="'+e+'" class="table-cell-text" id="'+a+'" name="'+a+'" >'+d+"</textarea>"},render:function(a){this.getCrmCampaignNumberMeta(a)},renderRow:function(a,b,j,l,m,c){var k=a;var h="";h+=" <tr>";h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValInput(k,"referrer-"+k,j),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValText(k,"display_name-"+k,l),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValInput(k,"number-"+k,m),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",this.showValCheckbox(k,"active-"+k,c),"item item-value");h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",'<code><span id="code-'+k+'">'+this.showVal(b)+"</span></code>","item item-value no-edit");var g=' <a style="display:none;" id="save-';g+=k;g+='" class="btn btn-success" href="javascript:void(0);" onclick="ServiceAPI.Instance.services.crmService.submitCRMNumberCampaignForm(\''+k+"');\">Save</a>";var d=' <a id="delete-';d+=k;d+='" class="btn btn-danger" href="javascript:void(0);" onclick="ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaignDialog(\''+k+"');\">Delete</a>";var f=' <a  class="btn btn-info" href="javascript:void(0);" onclick="ServiceAPI.Instance.services.crmService.testCRMNumberCampaign(\''+k+"');\">Test</a>";var e=f+d+g;h+=ServiceAPI.Instance.util.renderWrapTagStyles("td",e,"item item-value no-edit span3");h+=" </tr>";return h},renderResponse:function(c,g){var f="all";var k=1;var l=200;if(c.rangeType){f=c.rangeType}if(c.page){k=c.page}if(c.pageSize){l=c.pageSize}var h="";var j="";var n="";j+='<table id="crm-number-campaign-meta" class="table table-hover">';j+=" <thead>";j+=" <tr>";j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Campaign (URL Code)","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Source","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Phone Number","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Active","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Short Code","head-item item-head-value");j+=ServiceAPI.Instance.util.renderWrapTagStyles("th","Actions","head-item item-head-value");j+=" </tr>";j+=" </thead>";j+=" <tbody>";for(i=0;i<g.data.length;i++){var b=g.data[i].id;var a=g.data[i].code;var m=g.data[i].referrer;var o=g.data[i].display_name;var p=g.data[i].number;var e=g.data[i].active;j+=this.renderRow(b,a,m,o,p,e)}j+=" </tbody>";j+="</table>";$(c.div).html(j);$(c.div+" table tr td").bind("click",function d(q){if(!$(q.currentTarget).hasClass("no-edit")){if(q.currentTarget.contentEditable!=null){}else{}}})},adminAddNew:function(){var b=Math.uuid().toLowerCase();var a="#crm-number-campaign-meta tbody";ServiceAPI.Instance.util.log("id",b);ServiceAPI.Instance.util.log("tbl",a);this.adminAddTemplateRow(a,b)},adminAddTemplateRow:function(a,c){var b=this.renderRow(c,"","","","",false);ServiceAPI.Instance.util.log("rowTemplate",b);$(a).prepend(b)},currentDeleteId:null,deleteCRMNumberCampaignAction:function(){var a=ServiceAPI.Instance.services.crmService.currentDeleteId;ServiceAPI.Instance.util.log("modalDelete",a);ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaign(a);$("#modalDelete").modal({show:false})},testCRMNumberCampaign:function(b){var a=$("#referrer-"+b).val();document.location="/api/admin/test/?utm_content="+a},deleteCRMNumberCampaignDialog:function(a){this.currentDeleteId=a;$("#modalDelete").modal({show:true});$("#modal-delete-confirm").off("click",ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaignAction);$("#modal-delete-confirm").on("click",ServiceAPI.Instance.services.crmService.deleteCRMNumberCampaignAction)},submitCRMNumberCampaignForm:function(c){var a=$("#active-"+c).is(":checked");if(a){a="1"}else{a="0"}var b={code:c,values:{id:c,active:a,number:$("#number-"+c).val(),referrer:$("#referrer-"+c).val(),display_name:$("#display_name-"+c).val()}};ServiceAPI.Instance.log("filter",b);this.setCRMNumberCampaign(b)},setCRMNumberCampaign:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+=""+a.code;b+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",b);$.post(b,a.values,function(c){ServiceAPI.Instance.util.log("data",c);ServiceAPI.Instance.util.log("data.msg",c.msg);ServiceAPI.Instance.util.log("data.code",c.code);ServiceAPI.Instance.util.log("data.data",c.data);ServiceAPI.Instance.util.log("data.info",c.info);ServiceAPI.Instance.util.log("data.action",c.action);if(c.code>0||c.code.length>1){$("#save-"+a.code).hide();ServiceAPI.Instance.util.log("ERRORS:setCRMNumberCampaign",true)}else{$("#save-"+a.code).hide();ServiceAPI.Instance.util.log("SUCCESS:setCRMNumberCampaign",false)}},"json")},deleteCRMNumberCampaign:function(f){var e=ServiceAPI.Instance.services.apiUrlRoot;e+="/crm/crm-number-campaign-meta/";e+=""+f+"/delete/";e+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",e);var d="deleteCRMNumberCampaign";var c=d+"-"+f+"-delete-crmauth";ServiceAPI.Instance.util.log("shortCodePrep",c);var b=ServiceAPI.Instance.util.shortCode(c);ServiceAPI.Instance.util.log("shortCode",b);var a={shortCode:b,auth:d};ServiceAPI.Instance.util.log("values",a);$.post(e,a,function(g){ServiceAPI.Instance.util.log("data",g);ServiceAPI.Instance.util.log("data.msg",g.msg);ServiceAPI.Instance.util.log("data.code",g.code);ServiceAPI.Instance.util.log("data.data",g.data);ServiceAPI.Instance.util.log("data.info",g.info);ServiceAPI.Instance.util.log("data.action",g.action);if(g.code>0||g.code.length>1){ServiceAPI.Instance.util.log("ERRORS:deleteCRMNumberCampaign",true)}else{ServiceAPI.Instance.util.log("SUCCESS:deleteCRMNumberCampaign",false);crm.crmAdmin()}},"json")},getCRMNumberByCampaignReferrer:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+="referrer/"+a.referrer;b+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",b);$.get(b,null,function(d){ServiceAPI.Instance.util.log("data",d);ServiceAPI.Instance.util.log("data.msg",d.msg);ServiceAPI.Instance.util.log("data.code",d.code);ServiceAPI.Instance.util.log("data.data",d.data);ServiceAPI.Instance.util.log("data.info",d.info);ServiceAPI.Instance.util.log("data.action",d.action);if(d.code>0||d.code.length>1){ServiceAPI.Instance.util.log("ERRORS:getCRMNumberByCampaignReferrer",true)}else{ServiceAPI.Instance.util.log("SUCCESS:getCRMNumberByCampaignReferrer",false);if(d.data){var c=d.data.number;var e=d.data.active;ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get",c,1);if(ServiceAPI.Instance.services.crmService.showValBool(e)){if(!ServiceAPI.Instance.util.isNullOrEmptyString(c)){$(a.el).html(c);if(!$(a.el).hasClass("crm-fade-in")){$(a.el).addClass("crm-fade-in")}ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get-active",c,1)}}}}},"json")},getCRMNumberByCampaignCode:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+="code/"+a.code;b+="?format=json&callback=?";ServiceAPI.Instance.util.log("serviceUrl",b);$.get(b,null,function(d){ServiceAPI.Instance.util.log("data",d);ServiceAPI.Instance.util.log("data.msg",d.msg);ServiceAPI.Instance.util.log("data.code",d.code);ServiceAPI.Instance.util.log("data.data",d.data);ServiceAPI.Instance.util.log("data.info",d.info);ServiceAPI.Instance.util.log("data.action",d.action);if(d.code>0||d.code.length>1){ServiceAPI.Instance.util.log("ERRORS:getCRMNumberByCampaignCode",true)}else{ServiceAPI.Instance.util.log("SUCCESS:getCRMNumberByCampaignCode",false);if(d.data){var c=d.data.number;var e=d.data.active;ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get",c,1);if(ServiceAPI.Instance.services.crmService.showValBool(e)){if(!ServiceAPI.Instance.util.isNullOrEmptyString(c)){$(a.el).html(c);if(!$(a.el).hasClass("crm-fade-in")){$(a.el).addClass("crm-fade-in")}ServiceAPI.Instance.tracker.trackEventCRM("phonenumber-get-active",c,1)}}}}},"json")},getCRMNumberCampaignMeta:function(a){var b=ServiceAPI.Instance.services.apiUrlRoot;b+="/crm/crm-number-campaign-meta/";b+="?range="+a.rangeType;b+="&page="+a.page;b+="&page-size="+a.pageSize;if(a.username){b+="&code="+a.code}b+="&format=json&callback=?";this.filter=a;ServiceAPI.Instance.log("serviceUrl:",b);$.get(b,null,this.getCRMNumberCampaignMetaCallback,"json")},getCRMNumberCampaignMetaCallback:function(b){var c=ServiceAPI.Instance.services.crmService;var a=ServiceAPI.Instance.util.log;a("data",b);a("data.msg",b.msg);a("data.code",b.code);a("data.data",b.data);a("data.info",b.info);a("data.action",b.action);if(b.code>0||b.code.length>1){ServiceAPI.Instance.log("ERRORS:getCRMNumberCampaignMetaCallback",true)}else{ServiceAPI.Instance.log("SUCCESS:getCRMNumberCampaignMetaCallback",false);c.renderResponse(c.filter,b)}}})}),initialize:function(){ServiceAPI.Instance=this;this.Instance=this;this.initLibs();this.util=new this.Utility();this.profile=new this.Profile();this.profile.initAttributes();this.tracker=new this.Tracker();this.services=new this.Services();this.services.profileService=new this.services.ProfileService();this.services.crmService=new this.services.CRMService();this.controllers=new this.Controllers();this.controllers.uiController=new this.controllers.UIController();this.startUp();this.log("started up ServiceAPI")},startUp:function(){$("html").bind("tapone",this.controllers.uiController.eventHandlerTapOne);$("html").bind("taptwo",this.controllers.uiController.eventHandlerTapTwo);$("html").bind("tapthree",this.controllers.uiController.eventHandlerTapThree);$("html").bind("tapfour",this.controllers.uiController.eventHandlerTapFour);$("html").bind("swipeone",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipetwo",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipethree",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipefour",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipeup",this.controllers.uiController.eventHandlerSwipeUp);$("html").bind("swiperightup",this.controllers.uiController.eventHandlerSwipeRightUp);$("html").bind("swiperight",this.controllers.uiController.eventHandlerSwipeRight);$("html").bind("swiperightdown",this.controllers.uiController.eventHandlerSwipeRightDown);$("html").bind("swipedown",this.controllers.uiController.eventHandlerSwipeDown);$("html").bind("swipeleftdown",this.controllers.uiController.eventHandlerSwipeLeftDown);$("html").bind("swipeleft",this.controllers.uiController.eventHandlerSwipeLeft);$("html").bind("swipeleftup",this.controllers.uiController.eventHandlerSwipeLeftUp);$("html").bind("pinchopen",this.controllers.uiController.eventHandlerPinchOpen);$("html").bind("pinchclose",this.controllers.uiController.eventHandlerPinchClose);$("html").bind("rotatecw",this.controllers.uiController.eventHandlerRotateCW);$("html").bind("rotateccw",this.controllers.uiController.eventHandlerRotateCCW);$("html").bind("swipeone",this.controllers.uiController.eventHandlerSwipeOne);$("html").bind("swipemove",this.controllers.uiController.eventHandlerSwipeMove);$("html").bind("pinch",this.controllers.uiController.eventHandlerPinch);$("html").bind("rotate",this.controllers.uiController.eventHandlerRotate);$(".card .front").append('<span class="flip_back"></span>');$(".card .back").append('<span class="flip_front"></span>');this.controllers.uiController.initHistoryState()},log:function(a,b){if(window.console){console.log(a,b)}},hasProfileAttribute:function(a){return ServiceAPI.Instance.profile.hasAttribute(a)},getProfileAttribute:function(a){return ServiceAPI.Instance.profile.getAttribute(a)},setProfileAttribute:function(a,b){return ServiceAPI.Instance.profile.setAttribute(a,b)},syncCRMReferrer:function(){var b=$.query.get("utm_content");if(ServiceAPI.Instance.util.isNullOrEmptyString(b)){b="";ServiceAPI.Instance.tracker.trackEventCRM("referrer","no-referrer-or-inner-page",1);var c=this.getProfileAttribute("utm_content");if(ServiceAPI.Instance.util.isNullOrEmptyString(c)){ServiceAPI.Instance.tracker.trackEventCRM("referrer-return",c,1)}}else{ServiceAPI.Instance.log("updatingReferrer:",b);var a=ServiceAPI.Instance.util.shortCode(b);this.setProfileAttribute("crm-code",a);this.setProfileAttribute("utm_content",b);ServiceAPI.Instance.tracker.trackEventCRM("shortCode",a,1);ServiceAPI.Instance.tracker.trackEventCRM("referrer-landed",b,1)}return b},updateCRMNumberCampaigns:function(){var a=[".crm-number"];this.updateCRMNumberCampaignTags(a)},updateCRMNumberCampaignTags:function(b){var f="data-crm-type";var c="data-crm-code";var h="data-crm-referrer";var e="crm-code";var j="";var d="";var g=this.syncCRMReferrer();d=g;if(this.hasProfileAttribute(e)){j=this.getProfileAttribute(e);ServiceAPI.Instance.tracker.trackEventCRM("return-user-code",j,1);ServiceAPI.Instance.tracker.trackEventCRM("return-user-referrer",g,1)}else{ServiceAPI.Instance.tracker.trackEventCRM("new-user-code","none",1);ServiceAPI.Instance.tracker.trackEventCRM("new-user-referrer",g,1)}for(var a=0;a<b.length;a++){$(b[a]).each(function(m){var o=b[a];var p=$(this).html();var l=$(this).attr(f);var t=$(this).attr(c);var s=$(this).attr(h);ServiceAPI.Instance.tracker.trackEventCRM("dynamic-tag-update",o,1);ServiceAPI.Instance.log("crm:----------------","");ServiceAPI.Instance.log("crm:currentDataNumber",p);ServiceAPI.Instance.log("crm:currentDataType",l);ServiceAPI.Instance.log("crm:currentDataCode",t);ServiceAPI.Instance.log("crm:currentDataReferrer",s);var n=false;var q=false;var k=false;if(!ServiceAPI.Instance.util.isNullOrEmptyString(l)){if(l.toLowerCase()=="override"){n=true}}ServiceAPI.Instance.log("crm:isOverride",n);if(!n){q=true}else{if(!ServiceAPI.Instance.util.isNullOrEmptyString(t)){j=t;q=true}else{if(!ServiceAPI.Instance.util.isNullOrEmptyString(s)){d=s;k=true}}}if(!q){if(!$(o).hasClass("crm-fade-in")){$(o).addClass("crm-fade-in")}}if(q){if(!ServiceAPI.Instance.util.isNullOrEmptyString(j)){ServiceAPI.Instance.log("crm:updatingNumber:currentCode:",j);var r={code:j,el:this};ServiceAPI.Instance.log("crm:numberFilter",r);ServiceAPI.Instance.services.crmService.getCRMNumberByCampaignCode(r)}}if(k){if(!ServiceAPI.Instance.util.isNullOrEmptyString(d)){ServiceAPI.Instance.log("crm:updatingNumber:currentReferrer:",d);var r={referrer:d,el:this};ServiceAPI.Instance.log("crm:numberFilter",r);ServiceAPI.Instance.services.crmService.getCRMNumberByCampaignReferrer(r)}}})}},jQueryLoaded:function(){if(typeof jQuery=="undefined"){if(typeof $=="function"){return true}}else{return true}return false},getScript:function(c,e){var b=document.createElement("script");b.src=c;var d=document.getElementsByTagName("head")[0],a=false;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){a=true;e();b.onload=b.onreadystatechange=null;d.removeChild(b)}};d.appendChild(b)},initLibs:function(){if(this.jQueryLoaded()){return true}var a=false;this.getScript("//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",function(){if(typeof jQuery=="undefined"){a=false}else{a=true}});this.getScript("//code.jquery.com/jquery-migrate-1.1.0.min.js",function(){if(typeof jQuery=="undefined"){a=false}else{a=true}});return a}});var LoaderHelper=Class({Instance:function(){return this},log:function(a,b){if(window.console){console.log(a,b)}},initialize:function(a){this.log("started up LoaderHelper");this.initLibs(a)},jQueryLoaded:function(){this.log("initLibs: jQueryLoaded");if(typeof jQuery=="undefined"){this.log("initLibs: jQuery undefined");if(typeof $=="function"){this.log("initLibs: $ exists");this.log("initLibs: jQueryLoaded true");return true}else{this.log("initLibs: jQueryLoaded false");return false}}else{this.log("initLibs: jQueryLoaded true");if(typeof $=="function"){this.log("initLibs: $ exists");this.log("initLibs: jQueryLoaded true");return true}else{this.log("initLibs: $ updated");$=jQuery;return true}}this.log("initLibs: jQueryLoaded false");return false},getScript:function(c,e){var b=document.createElement("script");b.src=c;var d=document.getElementsByTagName("head")[0],a=false;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){a=true;e();b.onload=b.onreadystatechange=null;d.removeChild(b)}};d.appendChild(b)},initLibs:function(a){if(this.jQueryLoaded()){this.log("initLibs: jquery IS loaded");a();return true}this.log("initLibs: jquery not loaded");var b=false;this.getScript("//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",function(){if(typeof jQuery=="undefined"){b=false}else{b=true;this.log("initLibs: jquery load:"+b);this.getScript("//code.jquery.com/jquery-migrate-1.1.0.min.js",function(){if(typeof jQuery=="undefined"){b=false}else{b=true;a()}});this.log("initLibs: jquery migrate load:"+b)}});return b}});if(!window.crm){window.crm=function(){var a=null;return{failsafeId:null,failsafe:function(){this.failsafeId=setTimeout(this.failsafeFadeIn,670)},failsafeFadeIn:function(){if(!$(".crm-number").hasClass("crm-fade-in")){$(".crm-number").addClass("crm-fade-in")}clearInterval(this.failsafeId)},crm:function(){this.failsafe();var b=new LoaderHelper(function(){jQuery(function(){crm.serviceApi=new ServiceAPI();crm.serviceApi.updateCRMNumberCampaigns()})})},crmAdmin:function(){var b={div:"#crm-number-campaign-meta",code:"",rangeType:"all",page:1,pageSize:200};crm.serviceApi.services.crmService.getCRMNumberCampaignMeta(b,"")}}}()};